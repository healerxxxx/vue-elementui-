webpackJsonp([1],{1:function(e,t,i){i("j1ja"),e.exports=i("4Cid")},"1NFQ":function(e,t){},"3YPN":function(e,t){},"3caP":function(e,t){},"4Cid":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={};i.d(s,"dateFormat",function(){return si});var n=i("HSQo"),a=i.n(n),r=i("fZjL"),o=i.n(r),l=i("lRwf"),c=i.n(l),u=i("zL8q"),d=i.n(u),m=i("pFYg"),f=i.n(m),h=i("//Fk"),p=i.n(h),v=i("Dd8w"),g=i.n(v),b=i("mvHQ"),_=i.n(b),y=i("woOf"),w=i.n(y),T=i("Zrlr"),k=i.n(T),F=i("wxAW"),$=i.n(F),I=function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},C={},x=function(){function e(t){k()(this,e),this.config={headers:{ack:!0},body:"",heartTimer:29e3,statusCallback:function(){},noPongTimes:3},this.config=w()(this.config,t),/^ws(s)?:\/\//.test(this.config.url)||(this.config.url="ws://"+this.config.url),this.subObject={},this.subId={},this.pingIds=[],this.sidObj={},this.socket=null,this.status=null,this.lockReconnect=!1,this.connect()}return $()(e,[{key:"connect",value:function(){var e=this,t=window.WebSocket||window.MozWebSocket;if(!t)return this.status="NOT_SUPPORT",this.config.statusCallback(this.status),!1;this.socket=new t(this.config.url),this.status="CONNECTING",this.config.statusCallback(this.status),this.socket.onopen=function(t){for(var i in e.status="OPEN",e.config.statusCallback(e.status),e.keepHeart(),e.subObject){var s=e.subObject[i];s.success=!1,e.sub({headers:s.headers,body:s.body},!0)}},this.socket.onmessage=function(t){var i=JSON.parse(t.data);if(i.headers){var s=i.headers.sourceId||i.headers.id;if(C[s]){var n=C[s];n.timer&&clearTimeout(n.timer),200===i.status?n.resolveFn&&n.resolveFn(i):n.rejectFn&&n.rejectFn(i),delete C[s]}if("pong"===i.headers.cmd)return e.pingIds.indexOf(s)>-1&&(e.pingIds=[]),!1;if(s===e.sidObj.id)return void(e.sidObj.resolveFn&&e.sidObj.resolveFn(i));var a=e.subId[s];if(a){var r=e.subObject[a];"sub"===r.cmd?200===i.status?(r.success=!0,r.resolveFn&&r.resolveFn(i),clearTimeout(r.timer)):e.reSub(a,i):"unSub"===r.cmd&&(200===i.status?(clearTimeout(r.timer),r.resolveFn&&r.resolveFn(i),delete e.subObject[a]):e.reUnSub(a,i))}delete e.subId[s]}e.message(i)},this.socket.onclose=function(t){e.status="CLOSE",e.config.statusCallback(e.status)},this.socket.onerror=function(t){e.status="ERROR",e.config.statusCallback(e.status)}}},{key:"message",value:function(e){}},{key:"keepHeart",value:function(){var e=this;if(this.socket&&1===this.socket.readyState)if(this.pingIds.length>=this.config.noPongTimes)this.socket.close();else{var t=I();this.pingIds.push(t),clearTimeout(this.keepHeartTimer),this.send({headers:{cmd:"ping",id:t}}),this.keepHeartTimer=setTimeout(function(){e.keepHeart()},this.config.heartTimer)}}},{key:"getId",value:function(){var e=this;return new p.a(function(t){var i=I();e.sidObj={id:i,resolveFn:function(e){t(e)}},e.send({headers:{ack:!0,cmd:"sid",id:i}})})}},{key:"reSub",value:function(e,t){var i=this,s=this.subObject[e];s.number++,s.number>7?(clearTimeout(s.timer),s.rejectFn&&s.rejectFn(t),delete this.subObject[e]):(clearTimeout(s.timer),s.timer=setTimeout(function(){i.sub({headers:s.headers,body:s.body},!0)},1e3*Math.pow(2,s.number)))}},{key:"reUnSub",value:function(e,t){var i=this,s=this.subObject[e];s.number++,s.number>7?(clearTimeout(s.timer),s.rejectFn&&s.rejectFn(t),delete this.subObject[e]):(clearTimeout(s.timer),s.timer=setTimeout(function(){i.unSub({headers:s.headers,body:s.body},!0)},1e3*Math.pow(2,s.number)))}},{key:"sub",value:function(e,t){var i=this,s="";e&&e.headers&&e.headers.mq&&(s+=e.headers.mq),e&&e.headers&&e.headers.channel&&(s+=e.headers.channel);var n=I();this.subId[n]=s;var a={headers:w()(this.config.headers,{cmd:"sub",id:n},e&&e.headers?e.headers:{}),body:w()(this.config.body,e&&e.body?e.body:{})};if(!t)return new p.a(function(t,n){i.send(a),i.subObject[s]=w()({success:!1,number:0,timer:null,cmd:"sub",resolveFn:function(e){t(e)},rejectFn:function(e){n(e)}},e)});void 0===this.subObject[s].success||this.subObject[s].success||("unSub"===this.subObject[s].cmd&&(this.subObject[s].cmd="sub",this.subObject[s].number=0),this.send(a))}},{key:"unSub",value:function(e,t){var i=this,s="";if(e&&e.headers&&e.headers.mq&&(s+=e.headers.mq),e&&e.headers&&e.headers.channel&&(s+=e.headers.channel),this.subObject[s]){var n=I();this.subId[n]=s;var a={headers:w()(this.config.headers,{cmd:"unSub",id:n},e&&e.headers?e.headers:{}),body:w()(this.config.body,e&&e.body?e.body:{})};if("sub"===this.subObject[s].cmd&&(this.subObject[s].cmd="unSub",this.subObject[s].number=0),!t)return new p.a(function(e,t){i.send(a),i.subObject[s].resolveFn=function(t){return e(t)},i.subObject[s].rejectFn=function(e){return t(e)}});this.send(a)}}},{key:"send",value:function(e){var t=this;return new p.a(function(i,s){if(!t.socket||1!==t.socket.readyState)return s(new Error("the scoket is not open "));var n=null,a=I();"object"===(void 0===e?"undefined":f()(e))?(e&&e.headers&&!e.headers.id?e.headers.id=a:a=e.headers.id,n=_()(e)):n=_()(e),C[a]=e,C[a].resolveFn=function(e){return i(e)},C[a].rejectFn=function(e){return s(e)},C[a].timer=setTimeout(function(){s(new Error("socket send 15s timeout"))},15e3),t.socket.send(n)})}}]),e}(),S="/api/admin/login",L="/api/common/upload/{{serviceType}}",D="/api/admin/css/admin/update/loginStatus",E=i("mtWM"),N=i.n(E),M=function(e,t){return e?((t=t||{}).method=t.method||"get",t.url=e,t.urlParams&&(t.url=(i=t.url,(s=t.urlParams)?i.replace(/\{\{([^}]+)\}\}/g,function(e,t){return null!==s[t]||void 0!==s[t]?s[t]:e}):i)),t.headers=t.headers||{},N.a.defaults.headers.post["Content-Type"]=t.headers["Content-Type"]||"application/x-www-form-urlencoded;charset=UTF-8",t.transformRequest=function(e){if(!e||"object"!==(void 0===e?"undefined":f()(e))||t.headers["Content-Type"])return e;var i=[];for(var s in e)i.push(s+"="+encodeURIComponent("object"===f()(e[s])?_()(e[s]):e[s]));return i.join("&")},N.a.defaults.timeout=12e4,N()(t).then(function(e){return e.status&&200===e.status?p.a.resolve(e.data):p.a.reject(e)},function(t){var i=null;return i=t.response?{status:t.response.status,statusText:t.response.statusText,url:e}:e+" 接口权限不足",p.a.reject(i)})):p.a.reject(new Error("URL路径错误"));var i,s},R=i("NYxO"),H={name:"Header",computed:g()({},Object(R.d)(["userInfo"])),methods:{userLogout:function(){var e=this;M("/api/admin/logout").then(function(t){200===t.code?window.location.href=window.location.origin+S:e.$message.error("接口异常，退出失败！")},function(t){t&&e.$message.error("接口异常，退出失败！")})},submitStatus:function(e){var t=this;M(D,{method:"post",params:{loginStatus:e}}).then(function(e){200===e.code?t.$message.success("更新成功！"):t.$message.error(e.code+":"+e.message)},function(e){t.$message.error(_()(e))})},changeNotice:function(){var e=this;M("/api/admin/css/admin/update/needNotice",{method:"post",params:{needNotice:this.userInfo.needNotice}}).then(function(t){200===t.code?1===e.userInfo.needNotice?e.$message.success("开启手机邮箱通知！"):e.$message.success("关闭手机邮箱通知！"):e.$message.error(t.code+":"+t.message)},function(t){e.$message.error(_()(t))})}}},j={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"manager-header"},[i("div",{staticClass:"logo"},[e.$store.state.windowWidth>=1280?i("span",[e._v("红彩专属客服后台")]):i("span",{staticClass:"menu-icon",class:{open:!e.$store.state.menuOpen,close:e.$store.state.menuOpen},on:{click:function(t){e.$store.state.menuOpen=!e.$store.state.menuOpen}}})]),e._v(" "),e.userInfo?i("div",{staticClass:"user-info"},[i("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-color":"#F56C6C"},nativeOn:{click:function(t){return e.changeNotice()}},model:{value:e.userInfo.needNotice,callback:function(t){e.$set(e.userInfo,"needNotice",t)},expression:"userInfo.needNotice"}}),e._v(" "),i("span",[e._v(e._s(e.userInfo.needNotice?"开启手机邮箱通知":"关闭手机邮箱通知"))]),e._v(" "),i("a",{staticClass:"oldLink",attrs:{href:"/index.html",target:"_blank"}},[e._v("运营后台>>")]),e._v(" "),i("span",[e._v("你好，"+e._s(e.userInfo.adminName))]),e._v(" "),i("el-select",{staticStyle:{width:"110px"},attrs:{placeholder:"请选择",size:"mini"},on:{change:e.submitStatus},model:{value:e.userInfo.loginStatus,callback:function(t){e.$set(e.userInfo,"loginStatus",t)},expression:"userInfo.loginStatus"}},[i("el-option",{attrs:{label:"今天我在班",value:1}}),e._v(" "),i("el-option",{attrs:{label:"下班",value:0}})],1),e._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.userLogout()}}},[e._v("退出")])],1):e._e()])},staticRenderFns:[]};var O=i("VU/8")(H,j,!1,function(e){i("1NFQ")},null,null).exports,U=i("Gu7T"),Q=i.n(U),z=i("/ocq");c.a.use(R.a);var A={userInfo:null,windowHeight:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,windowWidth:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,menuOpen:!1,sessionList:[],currentSession:{},ws:null,wsStatus:null},V={getUserInfo:function(e){var t=e.commit;return new p.a(function(e,i){M(S,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(s){40110===s.code?M("/api/admin/css/admin/get/adminInfo").then(function(s){200===s.code?(t("setUserInfo",s.data),e(s)):i(s)},function(e){i(e)}):i(s)},function(e){i(e)})})},getSessionList:function(e){var t=e.commit;return M("/api/admin/css/session/session/userList").then(function(e){return 200===e.code?(t("setSessionList",e.data),p.a.resolve(e)):p.a.reject(e.message)},function(e){return p.a.reject(_()(e))})}},P=new R.a.Store({state:A,getters:{},mutations:{setUserInfo:function(e,t){e.userInfo=t},setSessionList:function(e,t){e.sessionList=t},setCurrentSession:function(e,t){e.currentSession=t},setWs:function(e,t){e.ws=t},setWsStatus:function(e,t){e.wsStatus=t}},actions:V}),q={name:"view",computed:{keepAliveRoutes:function(){return Lt()}}},W={render:function(){var e=this.$createElement,t=this._self._c||e;return t("keep-alive",{attrs:{include:[].concat(this.keepAliveRoutes)}},[t("router-view")],1)},staticRenderFns:[]},B=i("VU/8")(q,W,!1,null,null,null).exports,K={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"error"},[this._v("\n  Error\n")])},staticRenderFns:[]},X=i("VU/8")({name:"Error"},K,!1,null,null,null).exports,Y={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"forbidden"},[this._v("\n  权限不足\n")])},staticRenderFns:[]},G=i("VU/8")({name:"Forbidden"},Y,!1,null,null,null).exports,J="/api/admin/css/user/userCountInfo",Z="/api/admin/css/label/add",ee="/api/admin/css/label/update",te="/api/admin/css/user/update/remark",ie={name:"UserDetail",props:{userCurrentInfo:{type:Object,default:function(){return{}}}},filters:{status2CH:function(e){return{0:"失效客户",1:"过期客户",2:"有效客户"}[e]||""},level2CH:function(e){return{0:"小白",1:"银卡",2:"金卡",3:"钻石卡",4:"至尊VIP"}[e]||""},terminal2CH:function(e){return{1:"Android",2:"iOS"}[e]||""}},data:function(){return{inputVisible:!1,label:"",loading:!1,textarea:[],details:[],noData:!1,remarkShow:!0,showTag:!1}},created:function(){this.getUserCountInfo()},computed:g()({},Object(R.d)(["userInfo"]),{deviceList:function(){var e=this.details.userDeviceInfoList;return e&&e.length>0?e:null}}),watch:{userCurrentInfo:{deep:!0,handler:function(e,t){e.messageUserId!==t.messageUserId&&this.getUserCountInfo()}}},methods:{showInput:function(){var e=this;this.label="",this.inputVisible=!0,this.$nextTick(function(t){e.$refs.saveTagInput.$refs.input.focus(),e.$refs.saveTagInput.$refs.input.addEventListener("blur",e.addLabel)})},dblclick:function(e){var t=this;this.userInfo.adminNickname===this.details.adminName&&(e.isEdit=!0,this.$nextTick(function(e){t.$refs.upTagInput[0].$refs.input.focus()}))},showTextarea:function(){var e=this;this.remarkShow=!1,this.showTag=!0,this.$nextTick(function(t){e.$refs.textarea.$refs.textarea.focus(),e.$refs.textarea.$refs.textarea.addEventListener("blur",e.upRemark)})},addLabel:function(){var e=this;this.label.length<=16?this.label.replace(/\s*/g,"")?this.$service(Z,{method:"post",data:{messageUserId:this.userCurrentInfo.messageUserId,label:this.label}}).then(function(t){200===t.code?(e.details.labelList.push({labelTemp:e.label,userLabelId:t.data}),e.$message.success("添加成功"),e.$refs.saveTagInput.$refs.input.removeEventListener("blur",e.addLabel),e.inputVisible=!1):(e.$message.error(t.code+":"+t.message),e.inputVisible=!1)},function(t){t&&(e.$message.error(_()(t)),e.inputVisible=!1)}):(this.$message.error("标签不能为空"),this.inputVisible=!1):this.$message.error("标签的最大长度为16个字符")},upLabel:function(e){var t=this;e.label!==e.labelTemp&&(e.label.length<=16?e.label.replace(/\s*/g,"")?(e.labelTemp=e.label,this.$service(ee,{method:"post",data:{userLabelId:e.userLabelId,label:e.label}}).then(function(i){200===i.code?(t.$message.success("修改成功"),e.labelTemp=e.label,e.isEdit=!1):(t.$message.error(i.code+":"+i.message),e.isEdit=!1)},function(i){i&&(t.$message.error(_()(i)),e.isEdit=!1)})):(this.$message.error("标签不能为空"),e.label=e.labelTemp,e.isEdit=!1):(this.$message.error("标签的最大长度为16个字符"),e.label=e.labelTemp,e.isEdit=!1))},upRemark:function(){var e=this;this.details.remark.length<=100?this.details.remark.replace(/\s*/g,"")?this.$service(te,{method:"post",data:{messageUserId:this.userCurrentInfo.messageUserId,remark:this.details.remark}}).then(function(t){200===t.code?(e.$message.success("添加备注成功"),e.remarkShow=!0,e.showTag=!1,e.$refs.textarea.$refs.textarea.removeEventListener("blur",e.upRemark)):e.$message.error(t.code+":"+t.message)},function(t){t&&e.$message.error(_()(t))}):(this.showTag=!1,this.details.remark=""):this.$message.error("备注的最大程度为100个字符")},getUserCountInfo:function(){var e=this;this.$service(J,{params:{messageUserId:this.userCurrentInfo.messageUserId}}).then(function(t){200===t.code?(t.data.labelList.forEach(function(e){e.isEdit=!1,e.labelTemp=e.label}),e.details=t.data,e.$emit("updateInfo",t.data)):(e.noData=e.details<1,e.$message.error(t.code+":"+t.message))},function(t){t&&(e.noData=e.details<1,e.$message.error(_()(t)))})}}},se={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"user-detail"},[i("div",{staticClass:"tools"},[i("h1",[e._v("用户详情")]),e._v(" "),e.noData?e._e():i("el-tag",{staticClass:"user-status",attrs:{size:"small"}},[e._v(e._s(e._f("status2CH")(e.details.status)))])],1),e._v(" "),e.noData?e._e():i("div",{staticClass:"content"},[i("div",{staticClass:"personal-details"},[i("h2",[e._v("个人信息")]),e._v(" "),i("ul",[i("li",[i("label",[e._v("昵称：")]),e._v(" "),i("span",[e._v(e._s(e.details.nickname))])]),e._v(" "),i("li",[i("label",[e._v("用户ID：")]),e._v(" "),i("span",[e._v(e._s(e.details.userId))])]),e._v(" "),i("li",[i("label",[e._v("专属客服：")]),e._v(" "),i("span",[e._v(e._s(e.details.adminName))])])]),e._v(" "),i("ul",[i("li",[i("label",[e._v("最后消费时间：")]),e._v(" "),i("span",[e._v(e._s(e.details.lastDay)+"天前")])]),e._v(" "),i("li",[i("label",[e._v("消费总金额：")]),e._v(" "),i("span",[e._v(e._s(e.details.consumerNum)+"元")])]),e._v(" "),i("li",[i("label",[e._v("当季用户等级：")]),e._v(" "),i("span",[e._v(e._s(e._f("level2CH")(e.details.level)))])]),e._v(" "),i("li",[i("label",[e._v("上季用户等级：")]),e._v(" "),i("span",[e._v(e._s(e._f("level2CH")(e.details.levelPre)))])]),e._v(" "),i("li",[i("label",[e._v("是否VIP：")]),e._v(" "),2===e.details.status?i("span",[e._v("是")]):e._e(),e._v(" "),2===e.details.status||e.details.vipExpirationDay?e._e():i("span",[e._v("否")]),e._v(" "),2!==e.details.status&&e.details.vipExpirationDay?i("span",[e._v("过期"+e._s(Math.abs(e.details.vipExpirationDay))+"天")]):e._e()])]),e._v(" "),e.deviceList?i("ul",e._l(e.deviceList,function(t,s){return i("li",{key:s},[i("label",[e._v(e._s(0===s?"版本：":""))]),e._v(" "),i("span",[e._v(e._s(e._f("terminal2CH")(t.terminal))+"("+e._s(t.appVersion)+")")])])}),0):e._e()]),e._v(" "),i("div",{staticClass:"user-tag"},[i("h2",[e._v("用户标签")]),e._v(" "),e._l(e.details.labelList,function(t,s){return i("li",{key:s},[i("span",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit,expression:"!item.isEdit"}],staticClass:"tag",on:{dblclick:function(i){return e.dblclick(t)}}},[e._v("\n          "+e._s(t.labelTemp)+"\n        ")]),e._v(" "),i("el-input",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"item.isEdit"}],ref:"upTagInput",refInFor:!0,staticStyle:{width:"90px"},attrs:{size:"small"},on:{blur:function(i){return e.upLabel(t)}},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.upLabel(t)}},model:{value:t.label,callback:function(i){e.$set(t,"label",i)},expression:"item.label"}})],1)}),e._v(" "),i("el-input",{directives:[{name:"show",rawName:"v-show",value:e.inputVisible,expression:"inputVisible"}],ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addLabel(t)}},model:{value:e.label,callback:function(t){e.label=t},expression:"label"}}),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.userInfo.adminNickname===e.details.adminName&&!e.inputVisible,expression:"(userInfo.adminNickname === details.adminName) && !inputVisible"}],staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[e._v("+标签")]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.userInfo.adminNickname!==e.details.adminName&&(!e.details.labelList||e.details.labelList.length<=0),expression:"userInfo.adminNickname !== details.adminName && (!details.labelList || details.labelList.length <= 0)"}],staticStyle:{padding:"10px","font-size":"15px"}},[e._v("\n        暂无标签\n      ")])],2),e._v(" "),i("div",{staticClass:"remark"},[i("h2",[e._v("添加备注")]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.details.remark&&e.remarkShow,expression:"details.remark && remarkShow"}],staticClass:"remark-show",on:{click:e.showTextarea}},[e._v("\n        "+e._s(e.details.remark)+"\n      ")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.details.remark&&!e.showTag,expression:"!details.remark && !showTag"}],staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showTextarea}},[e._v("+备注\n      ")]),e._v(" "),i("el-input",{directives:[{name:"show",rawName:"v-show",value:e.showTag,expression:"showTag"}],ref:"textarea",staticStyle:{"font-size":"15px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请添加备注"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.upRemark(t)}},model:{value:e.details.remark,callback:function(t){e.$set(e.details,"remark",t)},expression:"details.remark"}})],1)]),e._v(" "),e.noData?i("div",{staticClass:"no-data"},[e._v("暂无数据")]):e._e()])},staticRenderFns:[]};var ne=i("VU/8")(ie,se,!1,function(e){i("tRRL")},null,null).exports,ae=i("gRE1"),re=i.n(ae),oe=i("oXIA"),le=i("3Q1+"),ce={CONTAIN:{name:"contain",icon:"el-icon-full-screen"},ORIGINAL:{name:"original",icon:"el-icon-c-scale-to-original"}},ue=Object(le.a)()?"DOMMouseScroll":"mousewheel",de={name:"elImageViewer",props:{urlList:{type:Array,default:function(){return[]}},zIndex:{type:Number,default:2e3},onSwitch:{type:Function,default:function(){}},onClose:{type:Function,default:function(){}},initialIndex:{type:Number,default:0}},data:function(){return{index:this.initialIndex,isShow:!1,infinite:!0,loading:!1,mode:ce.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}},computed:{isSingle:function(){return this.urlList.length<=1},isFirst:function(){return 0===this.index},isLast:function(){return this.index===this.urlList.length-1},currentImg:function(){return this.urlList[this.index]},imgStyle:function(){var e=this.transform,t=e.scale,i=e.deg,s=e.offsetX,n=e.offsetY,a={transform:"scale("+t+") rotate("+i+"deg)",transition:e.enableTransition?"transform .3s":"","margin-left":s+"px","margin-top":n+"px"};return this.mode===ce.CONTAIN&&(a.maxWidth=a.maxHeight="100%"),a}},watch:{index:{handler:function(e){this.reset(),this.onSwitch(e)}},currentImg:function(e){var t=this;this.$nextTick(function(e){t.$refs.img[0].complete||(t.loading=!0)})}},methods:{hide:function(){this.deviceSupportUninstall(),this.onClose()},deviceSupportInstall:function(){var e=this;this._keyDownHandler=Object(le.b)(function(t){switch(t.keyCode){case 27:e.hide();break;case 32:e.toggleMode();break;case 37:e.prev();break;case 38:e.handleActions("zoomIn");break;case 39:e.next();break;case 40:e.handleActions("zoomOut")}}),this._mouseWheelHandler=Object(le.b)(function(t){(t.wheelDelta?t.wheelDelta:-t.detail)>0?e.handleActions("zoomIn",{zoomRate:.015,enableTransition:!1}):e.handleActions("zoomOut",{zoomRate:.015,enableTransition:!1})}),Object(oe.b)(document,"keydown",this._keyDownHandler),Object(oe.b)(document,ue,this._mouseWheelHandler)},deviceSupportUninstall:function(){Object(oe.a)(document,"keydown",this._keyDownHandler),Object(oe.a)(document,ue,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad:function(e){this.loading=!1},handleImgError:function(e){this.loading=!1,e.target.alt="加载失败"},handleMouseDown:function(e){var t=this;if(!this.loading&&0===e.button){var i=this.transform,s=i.offsetX,n=i.offsetY,a=e.pageX,r=e.pageY;this._dragHandler=Object(le.b)(function(e){t.transform.offsetX=s+e.pageX-a,t.transform.offsetY=n+e.pageY-r}),Object(oe.b)(document,"mousemove",this._dragHandler),Object(oe.b)(document,"mouseup",function(e){Object(oe.a)(document,"mousemove",t._dragHandler)}),e.preventDefault()}},reset:function(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},toggleMode:function(){if(!this.loading){var e=o()(ce),t=(re()(ce).indexOf(this.mode)+1)%e.length;this.mode=ce[e[t]],this.reset()}},prev:function(){if(!this.isFirst||this.infinite){var e=this.urlList.length;this.index=(this.index-1+e)%e}},next:function(){if(!this.isLast||this.infinite){var e=this.urlList.length;this.index=(this.index+1)%e}},handleActions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.loading){var i=g()({zoomRate:.2,rotateDeg:90,enableTransition:!0},t),s=i.zoomRate,n=i.rotateDeg,a=i.enableTransition,r=this.transform;switch(e){case"zoomOut":r.scale>.2&&(r.scale=parseFloat((r.scale-s).toFixed(3)));break;case"zoomIn":r.scale=parseFloat((r.scale+s).toFixed(3));break;case"clocelise":r.deg+=n;break;case"anticlocelise":r.deg-=n}r.enableTransition=a}}},mounted:function(){this.deviceSupportInstall(),this.$refs["el-image-viewer__wrapper"].focus()}},me={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"viewer-fade"}},[i("div",{ref:"el-image-viewer__wrapper",staticClass:"el-image-viewer__wrapper",style:{"z-index":e.zIndex},attrs:{tabindex:"-1"}},[i("div",{staticClass:"el-image-viewer__mask"}),e._v(" "),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:e.hide}},[i("i",{staticClass:"el-icon-circle-close"})]),e._v(" "),e.isSingle?e._e():[i("span",{staticClass:"el-image-viewer__btn el-image-viewer__prev",class:{"is-disabled":!e.infinite&&e.isFirst},on:{click:e.prev}},[i("i",{staticClass:"el-icon-arrow-left"})]),e._v(" "),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__next",class:{"is-disabled":!e.infinite&&e.isLast},on:{click:e.next}},[i("i",{staticClass:"el-icon-arrow-right"})])],e._v(" "),i("div",{staticClass:"el-image-viewer__btn el-image-viewer__actions"},[i("div",{staticClass:"el-image-viewer__actions__inner"},[i("i",{staticClass:"el-icon-zoom-out",on:{click:function(t){return e.handleActions("zoomOut")}}}),e._v(" "),i("i",{staticClass:"el-icon-zoom-in",on:{click:function(t){return e.handleActions("zoomIn")}}}),e._v(" "),i("i",{staticClass:"el-image-viewer__actions__divider"}),e._v(" "),i("i",{class:e.mode.icon,on:{click:e.toggleMode}}),e._v(" "),i("i",{staticClass:"el-image-viewer__actions__divider"}),e._v(" "),i("i",{staticClass:"el-icon-refresh-left",on:{click:function(t){return e.handleActions("anticlocelise")}}}),e._v(" "),i("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.handleActions("clocelise")}}})])]),e._v(" "),i("div",{staticClass:"el-image-viewer__canvas"},e._l(e.urlList,function(t,s){return s===e.index?i("img",{key:t,ref:"img",refInFor:!0,staticClass:"el-image-viewer__img",style:e.imgStyle,attrs:{src:e.currentImg},on:{load:e.handleImgLoad,error:e.handleImgError,mousedown:e.handleMouseDown}}):e._e()}),0)],2)])},staticRenderFns:[]},fe=i("VU/8")(de,me,!1,null,null,null).exports,he={name:"MessageTypeImage",props:["img"],data:function(){return{type:null,isLoad:!1,error:!1,url:null,width:0,height:0}},computed:{imageClipper:function(){return 0!==this.width&&0!==this.height?"?imageView&thumbnail="+this.width+"y"+this.height+"&quality=85":""}},watch:{error:function(e){e&&this.$emit("imgError",e)}},mounted:function(){"[object File]"===Object.prototype.toString.call(this.img)?(this.type="file",this.fileReader(),this.uploadFileImg()):(this.type="http",this.loadHttpImg(this.img))},methods:{loadHttpImg:function(e){var t=this;this.isLoad=!1,this.error=!1;var i=new Image;i.src=e,i.onload=function(){var s=t.getImageSize(i);t.width=s.w,t.height=s.h,t.url=e,t.isLoad=!0,t.$emit("imgIsLoad")},i.onerror=function(){t.error=!0}},uploadFileImg:function(){var e=this;this.error=!1;var t=new FormData;t.append("0",this.img);var i={method:"post",urlParams:{serviceType:"im"},headers:{"Content-Type":"multipart/form-data"},data:t};this.$service(L,i).then(function(t){200===t.code?e.$emit("img2Url",t.data[0].sourceUrl):(e.error=!0,e.$message.error(t.message))}).catch(function(t){t&&(e.error=!0,e.$message.error("网络错误，图片上传失败"))})},drawCanvas:function(e){var t=this,i=this.$refs.canvas,s=new Image;s.src=e,s.onload=function(){var e=t.getImageSize(s);t.width=i.width=e.w,t.height=i.height=e.h,i.getContext("2d").drawImage(s,0,0,e.w,e.h)}},getImageSize:function(e){var t=void 0,i=void 0;return e.width>=e.height?(t=e.width>200?200:e.width<50?50:e.width,i=e.height*t/e.width):(i=e.height>200?200:e.height<50?50:e.height,t=e.width*i/e.height),{w:t,h:i}},fileReader:function(){var e=this,t=new FileReader;t.onload=function(t){e.drawCanvas(t.target.result)},t.readAsDataURL(this.img)},errorClick:function(){/^http/.test(this.img)?!1===this.isLoad&&this.loadHttpImg(this.img):this.uploadFileImg()},viewImg:function(){/^http/.test(this.img)&&this.$bus.$emit("imageView",this.img)}}},pe={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"message-type-image"},["http"!==e.type||e.isLoad?e._e():i("div",{staticClass:"placeholder"}),e._v(" "),"http"===e.type&&e.error?i("div",{staticClass:"error"}):e._e(),e._v(" "),"http"===e.type&&e.isLoad?i("img",{attrs:{src:e.url+e.imageClipper},on:{click:e.viewImg}}):e._e(),e._v(" "),i("canvas",{directives:[{name:"show",rawName:"v-show",value:"file"===e.type,expression:"type === 'file'"}],ref:"canvas",on:{click:e.viewImg}})])},staticRenderFns:[]};var ve={name:"MessageType",props:["info","showLine"],data:function(){return{infoTemp:{},fnScroll:function(){},scrollEmit:!1}},created:function(){this.infoTemp=g()({loading:2===this.info.contentType,error:!1},this.info),/^u-/.test(this.infoTemp.chatMessageId)&&1===this.infoTemp.contentType&&this.sendContent(this.infoTemp),this.fnScroll=Nt(this.parentScroll,50)},mounted:function(){4===this.infoTemp.typeId&&1===this.infoTemp.status&&(this.$parent.$refs.content.addEventListener("scroll",this.fnScroll),this.parentScroll())},watch:{info:{deep:!0,handler:function(e){this.infoTemp=g()({},this.infoTemp,e)}}},components:{MessageTypeImage:i("VU/8")(he,pe,!1,function(e){i("VK8O")},null,null).exports},filters:{dateFormat:function(e){var t=Dt(e,"yyyy-MM-dd"),i=Dt(new Date,"yyyy-MM-dd"),s=Dt(new Date-864e5,"yyyy-MM-dd");return i===t?"今天 "+Dt(e,"hh:mm:ss"):s===t?"昨天 "+Dt(e,"hh:mm:ss"):t.split("-")[0]===i.split("-")[0]?Dt(e,"MM-dd hh:mm:ss"):Dt(e,"yyyy-MM-dd hh:mm:ss")}},methods:{clearHtml:function(e){return e?e.replace(/<p>(<br(\s+)?(\/)?>)?<\/p>/gi,"").replace(/<div>(<br(\s+)?(\/)?>)?<\/div>/gi,""):e},parentScroll:function(e){var t=void 0,i=(t=e?e.target||e.srcElement:this.$parent.$refs.content).scrollTop,s=i+t.clientHeight,n=this.$el.offsetTop,a=n+this.$el.clientHeight,r=!1;n<=s&&n>=i&&(r=!0),a<=s&&a>=i&&(r=!0),a>=s&&n<=i&&(r=!0),r&&(this.scrollEmit||(this.$emit("inViewport",this.infoTemp.chatMessageId,this.infoTemp.messageUserId),this.scrollEmit=!0,this.$parent.$refs.content.removeEventListener("scroll",this.fnScroll)))},img2Url:function(e){this.infoTemp.content=e,this.sendContent(this.infoTemp),this.$emit("img2Url",this.infoTemp)},imgError:function(){this.infoTemp.loading=!1,this.infoTemp.error=!0},imgIsLoad:function(){/^u-/.test(this.infoTemp.chatMessageId)||(this.infoTemp.loading=!1,this.infoTemp.error=!1)},errorClick:function(){this.infoTemp.loading=!0,this.infoTemp.error=!1,/^u-/.test(this.infoTemp.chatMessageId)?2===this.infoTemp.contentType?/^http/.test(this.img)?this.sendContent(this.infoTemp):this.$refs.image&&this.$refs.image.errorClick():this.sendContent(this.infoTemp):this.$refs.image&&this.$refs.image.errorClick()},avatarError:function(e){var t=e.target||e.srcElement;(t.parentNode||t.parentElement).innerHTML='<div class="default_avatar"></div>'},sendContent:function(e){var t=this;this.infoTemp.loading=!0,this.$service("/api/admin/css/message/message/send",{method:"post",data:e}).then(function(e){if(t.infoTemp.loading=!1,200===e.code){var i=t.infoTemp.chatMessageId;t.infoTemp=g()({},t.infoTemp,e.data),t.$bus.$emit("transId",i,t.infoTemp)}else t.infoTemp.error=!0,t.$message.error(e.message)}).catch(function(e){e&&(t.$message.error(_()(e)),t.infoTemp.error=!0,t.infoTemp.loading=!1)})}}},ge={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"message-type-wrapper"},[e.showLine?i("div",{staticClass:"message-type__end line"},[i("div",{staticClass:"line"}),e._v(" "),i("span",[e._v("历史消息分割线")])]):e._e(),e._v(" "),1===e.infoTemp.typeId?i("div",{staticClass:"message-type__welcome"},[i("div",{staticClass:"content"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:e.infoTemp.avatar+"?imageView&thumbnail=40y40&quality=85"},on:{"~error":function(t){return e.avatarError(t)}}})]),e._v(" "),i("div",{staticClass:"text",domProps:{innerHTML:e._s("<p>"+e.infoTemp.content.replace(/\r|\n/g,"</p><p>")+"</p>")}})])]):e._e(),e._v(" "),3===e.infoTemp.typeId?i("div",{staticClass:"message-type__end"},[i("span",[e._v(e._s(e._f("dateFormat")(e.infoTemp.createTime))+" "+e._s(e.infoTemp.content))])]):e._e(),e._v(" "),6===e.infoTemp.typeId?i("div",{staticClass:"message-type__end"},[i("span",[e._v(e._s(e.infoTemp.content))])]):e._e(),e._v(" "),[2,4,5].indexOf(e.infoTemp.typeId)>-1?i("div",{staticClass:"message-type__base",class:{reverse:2===e.infoTemp.typeId||5===e.infoTemp.typeId}},[i("div",{staticClass:"message-type__base--content"},[i("div",{staticClass:"avatar"},[i("img",{attrs:{src:e.infoTemp.avatar+"?imageView&thumbnail=40y40&quality=85"},on:{"~error":function(t){return e.avatarError(t)}}})]),e._v(" "),i("div",{staticClass:"content"},[2===e.infoTemp.contentType?i("div",{staticClass:"img"},[i("message-type-image",{ref:"image",attrs:{img:e.infoTemp.content},on:{img2Url:e.img2Url,imgError:e.imgError,imgIsLoad:e.imgIsLoad}})],1):e._e(),e._v(" "),1===e.infoTemp.contentType?i("div",{staticClass:"text",domProps:{innerHTML:e._s(e.infoTemp.content)}}):e._e(),e._v(" "),e.infoTemp.loading?i("div",{staticClass:"icon loading"}):e._e(),e._v(" "),e.infoTemp.error?i("div",{staticClass:"icon error",on:{click:e.errorClick}}):e._e()])]),e._v(" "),i("div",{staticClass:"message-type__base--read"},[5!==e.infoTemp.typeId||1!==e.infoTemp.status&&2!==e.infoTemp.status?e._e():i("span",{staticClass:"read",class:{unread:1===e.infoTemp.status}},[e._v("\n        "+e._s({1:"未读",2:"已读"}[e.infoTemp.status])+"\n      ")]),e._v(" "),i("span",[e._v(e._s(e._f("dateFormat")(e.infoTemp.createTime)))])])]):e._e()])},staticRenderFns:[]};var be=i("VU/8")(ve,ge,!1,function(e){i("Eh2o")},null,null).exports,_e={name:"SessionUi",props:{type:{type:String,default:"history"},userInfo:{type:Object,default:function(){return{}}}},data:function(){return{list:[],noMore:!1,scrollTop:0,distanceBottom:0,fnScroll:function(){},showViewer:!1,imagePreviewList:[],previewStartPosition:0,historyLoading:!1,initLoading:!1,timer:!1,isReadId:0,refreshId:0,newMessage:[]}},computed:g()({},Object(R.d)(["currentSession","sessionList","ws","wsStatus"])),components:{ElImageViewer:fe,MessageType:be},watch:{userInfo:{deep:!0,handler:function(e,t){e.messageUserId!==t.messageUserId&&(this.list=[],this.noMore=!1,this.historyLoading=!1,this.initLoading=!1,this.isReadId=0,this.refreshId=0,this.newMessage=[],this.initSession())}},isReadId:function(e,t){0!==e&&this.updateRead(e)},wsStatus:function(e){"OPEN"===e?this.clearRefreshTiming():this.refreshTiming()}},created:function(){var e=this;this.fnScroll=Nt(this.contentScroll,50),this.$bus.$on("imageView",this.busImageView),this.$bus.$on("transId",this.busTransId),this.initSession(),this.$bus.$on("wsPushData",this.busWsPushData),document.addEventListener("visibilitychange",function(){document.hidden||e.refreshMessage()})},beforeDestroy:function(){var e=this;document.removeEventListener("visibilitychange",function(){document.hidden||e.refreshMessage()})},activated:function(){this.$refs.content.scrollTop=this.scrollTop},methods:g()({},Object(R.c)(["setSessionList","setCurrentSession"]),{initSession:function(){this.userInfo.messageUserId&&(this.initList(),"OPEN"===this.wsStatus?this.clearRefreshTiming():this.refreshTiming())},contentScroll:function(e){var t=this.$refs.content;t&&(this.scrollTop=t.scrollTop,this.distanceBottom=t.scrollHeight-t.clientHeight-t.scrollTop,this.distanceBottom<10&&(this.newMessage=[]))},contentScrollToBottom:function(){var e=this;this.$nextTick(function(){setTimeout(function(){e.$refs.content&&(e.$refs.content.scrollTop=e.$refs.content.scrollHeight)},0),setTimeout(function(){e.$refs.content&&(e.$refs.content.scrollTop=e.$refs.content.scrollHeight)},240)})},send:function(e,t){var i,s,n=(new Date).getTime(),a=n+""+(i=100,s=999,+Math.floor(i+Math.random()*(s-i))),r={createTime:n,avatar:this.$store.state.userInfo.avatar,chatMessageId:"u-"+a,id:a,contentType:e,messageUserId:this.userInfo.messageUserId,content:t,loading:!0,error:!1,status:1,typeId:5};this.setCurrentSession(g()({},this.currentSession,{contentType:e,messageContent:t,createTime:n})),this.list.push(r),this.contentScrollToBottom()},getHistory:function(){var e=this;if(!this.historyLoading&&!this.noMore){this.historyLoading=!0;var t={};this.list[0]&&!/^u-/.test(this.list[0].chatMessageId)&&(t.chatMessageId=this.list[0].chatMessageId),this.getList(t).then(function(t){var i=e.$refs.contentList.clientHeight,s=[];t.map(function(e){e.id=e.chatMessageId,s.unshift(e)}),e.list=[].concat(s,Q()(e.list)),e.$nextTick(function(){setTimeout(function(){e.$refs.content.scrollTop=e.$refs.content.scrollHeight-i-50},0)}),e.noMore=t.length<20,e.historyLoading=!1}).catch(function(t){t&&(e.$message.error(t),e.historyLoading=!1)})}},initList:function(){var e=this;this.initLoading||(this.initLoading=!0,this.getList().then(function(t){var i=[];t.reverse().map(function(e){e.id=e.chatMessageId,i.push(e)}),e.list=i,e.noMore=t.length<20,e.contentScrollToBottom(),e.initLoading=!1}).catch(function(t){t&&(e.$message.error(t),e.initLoading=!1)}))},getList:function(e){return this.$service("/api/admin/css/message/message/list",{params:g()({},e,{messageUserId:this.userInfo.messageUserId})}).then(function(e){return 200===e.code?p.a.resolve(e.data):p.a.reject(new Error(e.code+":"+e.message))},function(e){return p.a.reject(new Error(_()(e)))})},refreshMessage:function(){var e=this,t={},i=this.list.filter(function(e){return 5===e.typeId&&1===e.status&&!/^u-/.test(e.chatMessageId)});if(i.length>0)t.chatMessageId=i[0].chatMessageId;else if(this.list.length>0)for(var s=this.list.length-1;s>=0;s--)if(!/^u-/.test(this.list[s].chatMessageId)){t.chatMessageId=this.list[s].chatMessageId;break}this.$service("/api/admin/css/message/message/future/list",{params:g()({},t,{messageUserId:this.userInfo.messageUserId})}).then(function(t){200===t.code&&e.setNewMessage(t.data)})},inViewport:function(e,t){var i,s,n=this,a=this.newMessage.findIndex(function(t){return t.chatMessageId===e});a>-1&&this.newMessage.splice(a,1),(i=function(){n.userInfo.messageUserId===t&&e>n.isReadId&&(n.isReadId=e)},s=1500,function(e){var t=this,n=e;clearTimeout(i.id),i.id=setTimeout(function(){i.call(t,n)},s)})()},closeSession:function(){var e=this;this.$service("/api/admin/css/session/session/close",{params:{messageUserId:this.userInfo.messageUserId}}).then(function(t){200===t.code?(e.setSessionList(e.sessionList.filter(function(t){return t.messageUserId!==e.userInfo.messageUserId})),e.setCurrentSession({})):e.$message.error(t.message)}).catch(function(t){t&&e.$message.error(_()(t))})},updateRead:function(e){if(!e)return!1;"OPEN"===this.wsStatus?this.ws.send({headers:{cmd:"push",timeout:"5000",ACK_MODEL:2,method:"/api/admin/rocket/admin/read"},body:_()({messageUserId:this.userInfo.messageUserId})}):this.$service("/api/admin/css/message/update/all/read",{params:{messageUserId:this.userInfo.messageUserId}}).then(function(e){e.code})},busImageView:function(e){var t=[];this.list.map(function(e){2===e.contentType&&/^http/.test(e.content)&&t.push(e.content)}),this.imagePreviewList=t,this.previewStartPosition=t.findIndex(function(t){return t===e}),this.showViewer=!0},busTransId:function(e,t){var i=this.list.findIndex(function(t){return t.chatMessageId===e}),s=g()({},this.list[i],t);this.list.splice(i,1,s)},busWsPushData:function(e){if(1===e.msgTypeId&&e.data){var t=JSON.parse(e.data);t.messageUserId===this.userInfo.messageUserId&&this.setNewMessage([t])}if(3===e.msgTypeId&&e.data){var i=JSON.parse(e.data),s=i.messageUserId,n=i.chatMessageIdList;if(s===this.userInfo.messageUserId){n.sort(function(e,t){return e<t?1:-1});var a=n[0];this.list.forEach(function(e){5===e.typeId&&e.chatMessageId<=a&&1===e.status&&(e.status=2)})}}},setNewMessage:function(e){var t=this,i=[];e.map(function(e){e.id=e.chatMessageId;var s=t.list.findIndex(function(t){return t.chatMessageId===e.chatMessageId});-1===s?i.push(e):t.list.splice(s,1,e)}),i.filter(function(e){return 4===e.typeId}).length>0&&this.list.forEach(function(e){e.status=2}),i.length>0&&(this.list=[].concat(Q()(this.list),i),this.distanceBottom>30?this.newMessage=[].concat(Q()(this.newMessage),Q()(i.filter(function(e){return 4===e.typeId}))):this.contentScrollToBottom())},refreshTiming:function(){this.clearRefreshTiming(),"im"===this.type&&(this.timer=setInterval(this.refreshMessage,1e4))},clearRefreshTiming:function(){clearInterval(this.timer)},img2Url:function(e){var t=this.list.findIndex(function(t){return t.chatMessageId===e.chatMessageId}),i=g()({},this.list[t],e);this.list.splice(t,1,i)}})},ye={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"session-ui"},[i("div",{staticClass:"session-ui__header"},[i("b",[e._v(e._s(e.userInfo.userNickname||e.userInfo.nickname))]),e._v(" "),"im"===e.type?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.closeSession}},[e._v("结束服务")]):e._e()],1),e._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.initLoading,expression:"initLoading"}],staticClass:"session-ui__content"},[i("div",{ref:"content",staticClass:"session-ui__content--wrapper",on:{"&scroll":function(t){return e.fnScroll(t)}}},[e.noMore||e.initLoading?e._e():i("div",{staticClass:"load-more"},[i("span",{class:{loading:e.historyLoading},on:{click:e.getHistory}},[e._v("\n          "+e._s(e.historyLoading?"正在加载...":"加载更多")+"\n        ")])]),e._v(" "),i("div",{ref:"contentList",staticClass:"session-ui__content--list"},e._l(e.list,function(t,s){return i("message-type",{key:t.id,attrs:{showLine:s>0&&t.sessionId!==e.list[s-1].sessionId&&!/^u-/.test(t.chatMessageId)&&!/^u-/.test(e.list[s-1].chatMessageId),info:t},on:{send:e.reSend,inViewport:e.inViewport,img2Url:e.img2Url}})}),1)]),e._v(" "),e.newMessage.length>0?i("div",{staticClass:"session-ui__new-message",on:{click:e.contentScrollToBottom}},[i("div",{staticClass:"icon"}),e._v(" "),i("span",[e._v("您有"+e._s(e.newMessage.length)+"条新消息")])]):e._e()]),e._v(" "),e.showViewer?i("el-image-viewer",{attrs:{"url-list":e.imagePreviewList,"on-close":function(){return e.showViewer=!1},"initial-index":e.previewStartPosition}}):e._e()],1)},staticRenderFns:[]};var we=i("VU/8")(_e,ye,!1,function(e){i("cF9M")},null,null).exports,Te=i("c/Tr"),ke=i.n(Te),Fe=void 0;function $e(){var e=void 0;return document.selection&&document.selection.createRange?e=document.selection.createRange():window.getSelection&&window.getSelection().rangeCount>0&&(e=window.getSelection().getRangeAt(0)),e}function Ie(){Fe=$e()}function Ce(){var e=window.getSelection?window.getSelection():document.selection;if(Fe)try{e.removeAllRanges(),e.addRange(Fe)}catch(i){var t=e.createRange();t.setEndPoint("StartToStart",Fe),t.select()}}var xe="/api/admin/css/admin/update/nickname",Se="/api/admin/css/admin/update/avatar",Le="/api/admin/css/admin/update/shortcut",De="/api/admin/css/admin/add",Ee="/api/admin/css/fastReply/list",Ne="/api/admin/css/fastReply/add",Me="/api/admin/css/fastReply/update",Re="/api/admin/css/fastReply/search/key",He="/api/admin/css/fastReply/del",je=i("5rWc"),Oe={name:"Emoji",props:{value:{type:Boolean,default:!1},column:{type:Number,default:8},row:{type:Number,default:5}},data:function(){return{list:[{code:"😁"},{code:"😂"},{code:"😃"},{code:"😄"},{code:"😅"},{code:"😆"},{code:"😉"},{code:"😊"},{code:"😋"},{code:"😌"},{code:"😍"},{code:"😏"},{code:"😒"},{code:"😓"},{code:"😔"},{code:"😖"},{code:"😘"},{code:"😚"},{code:"😜"},{code:"😝"},{code:"😞"},{code:"😠"},{code:"😡"},{code:"😢"},{code:"😣"},{code:"😤"},{code:"😥"},{code:"😨"},{code:"😩"},{code:"😪"},{code:"😫"},{code:"😭"},{code:"😰"},{code:"😱"},{code:"😲"},{code:"😳"},{code:"😵"},{code:"😷"},{code:"😸"},{code:"😹"},{code:"😺"},{code:"😻"},{code:"😼"},{code:"😽"},{code:"😾"},{code:"😿"},{code:"🙀"},{code:"🙅"},{code:"🙆"},{code:"🙇"},{code:"🙈"},{code:"🙉"},{code:"🙊"},{code:"🙋"},{code:"🙌"},{code:"🙍"},{code:"🙎"},{code:"🙏"}],current:1}},computed:{total:function(){return this.list.length},size:function(){return this.row*this.column},renderList:function(){return this.list.slice((this.current-1)*this.size,this.current*this.size)},visible:{get:function(){return this.value},set:function(e){this.$emit("input",e)}}},methods:{pageChange:function(e){e!==this.current&&(this.current=e)}}},Ue={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.visible?i("div",{staticClass:"imoji-wrapper",style:{"margin-left":20*-e.column+"px"}},[i("div",{staticClass:"imoji-content",style:{height:40*e.row+"px",width:40*e.column+"px"}},e._l(e.renderList,function(t,s){return i("li",{key:s},[i("span",{on:{click:function(i){return e.$emit("click",t.code)}}},[e._v(e._s(t.code))])])}),0),e._v(" "),e.size<e.total?i("div",{staticClass:"imoji-dot"},e._l(Math.ceil(e.total/e.size),function(t){return i("i",{key:t,class:{current:t===e.current},on:{click:function(i){return e.pageChange(t)}}})}),0):e._e()]):e._e()},staticRenderFns:[]};var Qe=i("VU/8")(Oe,Ue,!1,function(e){i("ID8m")},null,null).exports;function ze(e){if(window.getSelection){var t=window.getSelection();t.selectAllChildren(e),t.collapseToEnd()}else if(document.selection){var i=document.selection.createRange();i.moveToElementText(e),i.collapse(!1),i.select()}Ie()}var Ae={name:"Editor",props:["shortcutKey"],data:function(){return{content:"",isEmoji:!1,viewStyle:{italic:!1,underline:!1,bold:!1},quickReplyVisible:!1,quickReplyStyle:{},quickReplyList:[],quickReplyText:null,quickReplyTextEle:null}},computed:{submitEnable:function(){var e=this.content;return e.length>0&&e.length<=1e3&&"<p><br /></p>"!==e&&"<p><br/></p>"!==e&&"<p><br></p>"!==e}},components:{Emoji:Qe},created:function(){document.addEventListener("click",this.hideEmoji)},beforeDestroy:function(){document.removeEventListener("click",this.hideEmoji)},watch:{quickReplyText:function(e){var t=this;console.log(e),e?this.quickReplySearch(e).then(function(e){t.quickReplyList=e}):this.quickReplyList=[],this.quickReplyVisible=!!e},quickReplyVisible:function(e){e&&this.setQuickReplyPosition()}},methods:{execCommand:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"insertHTML",t=arguments[1];Ce(),this.$refs.textarea.focus(),document.execCommand(e,!1,t),Ie()},textareaPaste:function(e){e.preventDefault();var t=e.clipboardData.getData("text");this.execCommand("insertText",Et(t))},textareaSaveSelection:function(){Ie()},setTagStyle:function(){this.viewStyle=function(){var e=Fe||$e(),t=e&&e.commonAncestorContainer,i=["U","I","B"],s=[];if(t){var n=null;for(3===t.nodeType&&(t=t.parentNode),n=t;n&&n.nodeName&&-1===s.indexOf(n.nodeName.toLowerCase());)-1!==i.indexOf(n.nodeName)&&s.push(n.nodeName),n=n.parentNode}return{italic:-1!==s.indexOf("I"),underline:-1!==s.indexOf("U"),bold:-1!==s.indexOf("B")}}()},textareaInput:function(e){this.content=e.target.innerHTML,this.$emit("input",this.content)},switchEmoji:function(){this.isEmoji=!this.isEmoji,this.$refs.textarea.focus(),Ce()},insertEmoji:function(e){this.$refs.textarea.focus(),Ce(),this.execCommand("insertHTML",e),Ie()},hideEmoji:function(e){this.$refs.emoji.$el.contains(e.target)||(this.isEmoji=!1,this.quickReplyVisible=!1)},chooseImg:function(){this.$refs.referenceUpload.click()},fileData:function(e){var t=this,i=e.target.files||e.dataTransfer.files;ke()(i).map(function(e){t.$emit("send",2,e)}),this.$refs.referenceUpload.value=""},addLink:function(){var e=this;this.$prompt("请输入网址",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^((http|https|ftp):\/\/)(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,=]|:|@)|\/|\?)*)?$/i,inputErrorMessage:"网址格式不正确"}).then(function(t){var i=t.value;e.execCommand("createlink",i)})},send:function(){if(this.content.length<=0||this.content.length>1e3)return!1;this.$emit("send",1,Et(this.content)),this.clear()},ctrlEnterEvent:function(e){var t=(e=e||window.event).keyCode||e.which;if(e.shiftKey&&(51===t||"Digit3"===e.code)){e.preventDefault();var i=(new Date).getTime();document.selection&&document.selection.createRange?(range=document.selection.createRange(),range.pasteHTML('<span id="quick-replay-'+i+'">#</span>&nbsp;')):document.execCommand("insertHtml",!1,'<span id="quick-replay-'+i+'">#</span>&nbsp;');var s=document.getElementById("quick-replay-"+i);if(setTimeout(function(){"##"===s.innerText&&(s.innerText="#",ze(s))},0),ze(s),!e.preventDefault)return!1;e.preventDefault()}if(1===this.shortcutKey&&e.ctrlKey&&13===t&&this.send(),0===this.shortcutKey)if(13===t&&e.ctrlKey){var n=document.createElement("p");n.innerHTML="<br />";var a=null,r=Fe||$e(),o=r&&r.commonAncestorContainer;if(o){var l=null;for(3===o.nodeType&&(o=o.parentNode),l=o;l&&l.nodeName;){if("p"===l.nodeName.toLowerCase()){a=l;break}l=l.parentNode}}a.parentNode.insertBefore(n,a.nextSibling),ze(n)}else if(13===t){if(this.send(),!e.preventDefault)return!1;e.preventDefault()}},getTextBeforeCursor:function(){var e=Fe||$e(),t=e&&e.commonAncestorContainer;if(t){var i=null;for(3===t.nodeType&&(t=t.parentNode),i=t;i&&i.nodeName;){if("span"===i.nodeName.toLowerCase()&&i.id){this.quickReplyTextEle=i;var s=i.innerText.replace("#","");return void(this.quickReplyText=s||null)}i=i.parentNode}}this.quickReplyText=null,this.quickReplyTextEle=null},setQuickReplyPosition:function(){var e=this.$refs.textarea,t=this.$refs.quickReply,i=e.offsetWidth,s=e.offsetHeight,n=t.offsetWidth,a=t.offsetHeight,r=0,o=0,l=Object(je.b)(e),c=Object(je.a)(e);r=i-l.left<n?c.left-n:c.left,o=s-l.top<a?c.top-a:c.top+20,this.quickReplyStyle={left:r+"px",top:o+"px"}},clear:function(){this.$refs.textarea.innerHTML="<p><br /></p>",this.content=""},quickReplySearch:function(e){var t=this;return this.$service(Re,{method:"post",data:{key:e}}).then(function(e){return t.loading=!1,200===e.code?p.a.resolve(e.data):p.a.reject(new Error(e.code+":"+e.message))},function(e){if(e)return p.a.reject(new Error(e))})},replaceQuickReply:function(e){if(this.quickReplyTextEle){var t=document.createRange().createContextualFragment(e);this.quickReplyTextEle.parentNode.insertBefore(t,this.quickReplyTextEle),ze(this.quickReplyTextEle),this.quickReplyTextEle.parentNode.removeChild(this.quickReplyTextEle),this.content=this.$refs.textarea.innerHTML}}}},Ve={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"im-editor"},[i("div",{staticClass:"im-editor__toolbar"},[i("input",{ref:"referenceUpload",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*",multiple:""},on:{change:e.fileData}}),e._v(" "),i("li",[i("span",{staticClass:"icon-emoji",class:{active:e.isEmoji},on:{click:function(t){return t.stopPropagation(),e.switchEmoji(t)}}}),e._v(" "),i("emoji",{ref:"emoji",on:{click:e.insertEmoji},model:{value:e.isEmoji,callback:function(t){e.isEmoji=t},expression:"isEmoji"}})],1),e._v(" "),i("li",[i("i",{staticClass:"el-icon-picture-outline",on:{click:e.chooseImg}})]),e._v(" "),i("li",{staticClass:"inline-command"},[i("span",{class:{active:e.viewStyle.bold},on:{click:function(t){return e.execCommand("bold")}}},[i("b",[e._v("B")])]),e._v(" "),i("span",{class:{active:e.viewStyle.italic},on:{click:function(t){return e.execCommand("italic")}}},[e._m(0)]),e._v(" "),i("span",{class:{active:e.viewStyle.underline},on:{click:function(t){return e.execCommand("underline")}}},[e._m(1)]),e._v(" "),i("span",{on:{click:e.addLink}},[e._m(2)])])]),e._v(" "),i("div",{ref:"textarea",staticClass:"im-editor__content",attrs:{contenteditable:"true",spellcheck:"false",tabindex:"0"},on:{keydown:e.ctrlEnterEvent,keyup:function(t){e.textareaSaveSelection(),e.setTagStyle(),e.getTextBeforeCursor()},mouseup:function(t){e.textareaSaveSelection(),e.setTagStyle(),e.getTextBeforeCursor()},mouseout:e.textareaSaveSelection,paste:e.textareaPaste,input:e.textareaInput}},[e._m(3)]),e._v(" "),i("el-button",{staticClass:"im-editor__send-button",attrs:{type:e.submitEnable?"primary":"info",size:"mini"},on:{click:e.send}},[e._v("\n    发送"+e._s((1===e.shortcutKey?"(Ctrl+Enter)":"")+(0===e.shortcutKey?"(Enter)":""))+"\n  ")]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.quickReplyVisible,expression:"quickReplyVisible"}],ref:"quickReply",staticClass:"quick-reply-box",style:e.quickReplyStyle},e._l(e.quickReplyList,function(t,s){return i("li",{key:t.fastReplyId,class:{odd:s%2==1},on:{click:function(i){return e.replaceQuickReply(t.content)}}},[i("span",{domProps:{innerHTML:e._s(t.content)}})])}),0)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("b",[t("i",[this._v("I")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("b",[t("u",[this._v("U")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("b",[t("u",[this._v("A")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("br")])}]};var Pe=i("VU/8")(Ae,Ve,!1,function(e){i("3YPN")},null,null).exports,qe={name:"Current",data:function(){return{activeName:"1",userId:0,nickname:"",currentId:0,avatar:"https://relottery.ws.126.net/thread/20191115/oWbNQe.png"}},computed:g()({},Object(R.d)(["userInfo","sessionList","currentSession"]),{shortcutKey:function(){return this.userInfo?this.userInfo.shortcutKey:null},currentList:function(){return this.sessionList.filter(function(e){return 1===e.sessionType})},otherList:function(){return this.sessionList.filter(function(e){return 2===e.sessionType})},list:function(){return"1"===this.activeName?this.currentList:this.otherList},noReadLen:function(){return this.currentList.filter(function(e){return e.notReadNum>0}).length},otherNoReadLen:function(){return this.otherList.filter(function(e){return e.notReadNum>0}).length}}),components:{UserDetail:ne,SessionUi:we,ImEditor:Pe},filters:{content2Text:function(e){var t=document.createElement("div");return t.innerHTML=e,t.style.display="none",t.textContent||t.innerText},dateFormat:function(e){var t=Dt(e,"yyyy-MM-dd"),i=Dt(new Date,"yyyy-MM-dd");return Dt(e,i===t?"hh:mm:ss":"MM-dd hh:mm")}},activated:function(){this.$route.query.type&&(this.activeName=this.$route.query.type.toString())},watch:{sessionList:{deep:!0,handler:function(e){var t=this,i=e.find(function(e){return e.messageUserId===t.currentSession.messageUserId});i&&this.setCurrentSession(g()({},this.currentSession,i,{notReadNum:0}))}}},methods:g()({},Object(R.c)(["setCurrentSession"]),{errorImg:function(e){e.target.src="https://relottery.ws.126.net/thread/20191115/oWbNQe.png"},chooseUser:function(e){this.setCurrentSession(g()({},e,{notReadNum:0})),this.$refs.editor&&this.$refs.editor.clear()}})},We={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"current"},[e.sessionList.length>0?i("div",{staticClass:"current__list"},[i("el-tabs",{attrs:{stretch:"true"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{name:"1"}},[i("span",{staticClass:"item-1",attrs:{slot:"label"},slot:"label"},[e.noReadLen>0?i("el-badge",{attrs:{value:e.noReadLen}}):e._e(),e._v("\n          "+e._s("我的客户("+e.noReadLen+"/"+e.currentList.length+")")+"\n        ")],1)]),e._v(" "),i("el-tab-pane",{attrs:{name:"2"}},[i("span",{staticClass:"item-2",attrs:{slot:"label"},slot:"label"},[e.otherNoReadLen>0?i("el-badge",{attrs:{value:e.otherNoReadLen}}):e._e(),e._v("\n          "+e._s("其他客户("+e.otherNoReadLen+"/"+e.otherList.length+")")+"\n        ")],1)])],1),e._v(" "),i("ul",e._l(e.list,function(t){return i("li",{key:t.messageUserId,class:{"is-active":t.messageUserId===e.currentSession.messageUserId},on:{click:function(i){return e.chooseUser(t)}}},[i("img",{attrs:{src:t.avatar||e.avatar+"?imageView&thumbnail=40y40&quality=85"},on:{"~error":function(t){return e.errorImg(t)}}}),e._v(" "),i("div",{staticClass:"message"},[i("div",{staticClass:"name"},[e._v(e._s(t.userNickname))]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.adminNickname&&"2"==e.activeName,expression:"item.adminNickname && activeName == '2'"}],staticClass:"nickname"},[e._v(e._s(t.adminNickname))]),e._v(" "),i("div",{staticClass:"content"},[i("span",[t.notReadNum>0&&t.messageUserId!==e.currentSession.messageUserId?i("i",{staticClass:"un-read"},[e._v("["+e._s(t.notReadNum)+"条]")]):e._e(),e._v(" "),2===t.messageType?i("i",[e._v("[图片]")]):e._e(),e._v(" "),1===t.messageType?i("i",[e._v(" "+e._s(e._f("content2Text")(t.messageContent)))]):e._e()])]),e._v(" "),t.messageContent?i("div",{staticClass:"date"},[e._v(e._s(e._f("dateFormat")(t.createTime)))]):e._e(),e._v(" "),t.notReadNum>0&&t.messageUserId!==e.currentSession.messageUserId?i("el-badge",{staticClass:"noread",class:{"my-noread":"1"==e.activeName},attrs:{value:t.notReadNum}}):e._e()],1)])}),0)],1):e._e(),e._v(" "),e.currentSession.messageUserId?i("div",{staticClass:"current__main"},[i("session-ui",{ref:"sessionContent",staticClass:"current__session-ui",attrs:{type:"im",userInfo:e.currentSession}}),e._v(" "),i("im-editor",{ref:"editor",attrs:{shortcutKey:e.shortcutKey},on:{send:function(t,i){return e.$refs.sessionContent.send(t,i)}}})],1):e._e(),e._v(" "),e.currentSession.messageUserId?i("div",{staticClass:"current__detail"},[i("UserDetail",{attrs:{userCurrentInfo:e.currentSession}})],1):e._e(),e._v(" "),e.sessionList.length<=0?i("div",{staticClass:"current__no-data"},[i("span",[e._v("暂无数据")])]):e._e()])},staticRenderFns:[]};var Be=i("VU/8")(qe,We,!1,function(e){i("3caP")},null,null).exports,Ke={name:"Conversation",props:{userInfo:{type:Object,default:function(){return{}}},value:{type:Boolean,default:!1}},date:function(){return{messageInfo:{},userDetailInfo:null}},computed:{drawer:{get:function(){return this.value},set:function(e){return this.$emit("input",e)}}},components:{UserDetail:ne,SessionUi:we},methods:g()({},Object(R.c)(["setCurrentSession"]),{toCurrent:function(){var e=this;0!==this.userDetailInfo.status?this.$service("/api/admin/css/session/session/open",{params:{messageUserId:this.userInfo.messageUserId}}).then(function(t){200===t.code?(e.$emit("input",!1),e.messageInfo=t.data||{},e.$router.push({name:"Current",query:{type:e.messageInfo.sessionType}}),e.setCurrentSession(g()({},e.messageInfo,{notReadNum:0,userNickname:e.userDetailInfo.nickname}))):e.$message.error(t.code+":"+t.message)},function(t){t&&e.$message.error(_()(t))}):this.$message.error("该用户已失效，不能发起会话")}})},Xe={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-drawer",{staticClass:"conversation",attrs:{visible:e.drawer,"with-header":!1,size:"75%"},on:{"update:visible":function(t){e.drawer=t}}},[e.drawer?i("div",{staticClass:"conversation__session"},[i("session-ui",{ref:"sessionContent",staticClass:"conversation__session-ui",attrs:{userInfo:e.userInfo}}),e._v(" "),i("div",{staticClass:"start",on:{click:e.toCurrent}},[e._v("\n      发起会话\n    ")])],1):e._e(),e._v(" "),e.drawer?i("div",{staticClass:"conversation__detail"},[i("UserDetail",{attrs:{userCurrentInfo:e.userInfo},on:{updateInfo:function(t){return e.userDetailInfo=t}}})],1):e._e()])},staticRenderFns:[]};var Ye=i("VU/8")(Ke,Xe,!1,function(e){i("R6KW")},null,null).exports,Ge="/api/admin/css/session/leave/list",Je={name:"Message",data:function(){return{offset:0,limit:20,total:1,loading:!1,drawer:!1,tableHeight:null,filterQuery:{startTime:Dt((new Date).setDate((new Date).getDate()-2),"yyyy-MM-dd")+" 00:00:00",endTime:Dt(new Date,"yyyy-MM-dd")+" 23:59:59",sessionType:0,exclusiveStatus:-1},currentSessionObj:{}}},computed:g()({},Object(R.d)(["windowHeight"])),created:function(){this.getFilterList(),this.setHeight()},components:{Conversation:Ye},filters:{sessionType2CH:function(e){return{2:"他人代答",3:"下班留言"}[e]||""}},methods:{setHeight:function(){var e=this;this.$nextTick(function(){e.tableHeight=e.windowHeight-e.$refs.elTable.$el.offsetTop-63})},getFilterList:function(e){var t=this;if(!this.loading){this.loading=!0,this.offset="number"==typeof e&&e?(e-1)*this.limit:0;var i={offset:this.offset,limit:this.limit,exclusiveStatus:this.filterQuery.exclusiveStatus,sessionType:this.filterQuery.sessionType};this.filterQuery.startTime&&(i.startTime=this.filterQuery.startTime),this.filterQuery.endTime&&(i.endTime=this.filterQuery.endTime),this.$service(Ge,{params:i}).then(function(e){t.loading=!1,200===e.code?(t.listType="filter",t.$refs.elTable.bodyWrapper.scrollTop=0,t.list=e.data.data||[],t.total=e.data.total||1):t.$message.error(e.code+":"+e.message)},function(e){e&&(t.loading=!1,t.$message.error(_()(e)))})}},conversationShow:function(e){this.drawer=!0,this.currentSessionObj=e},dateFormat:function(e){return Dt(e,"yyyy-MM-dd hh:mm:ss")}},watch:{windowHeight:function(){this.setHeight()}}},Ze={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"message-record"},[i("div",{staticClass:"nav-tools"},[i("div",{staticClass:"nav"},[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),e._v(" "),e._l(e.$route.matched,function(t,s){return i("el-breadcrumb-item",{key:s},[e._v(e._s(t.meta.title)+"\n        ")])})],2)],1)]),e._v(" "),i("el-form",{attrs:{model:e.filterQuery,inline:!0,size:"mini",disabled:e.loading}},[i("el-form-item",[i("el-date-picker",{staticStyle:{width:"135px"},attrs:{type:"date",editable:"false",placeholder:"开始日期","value-format":"yyyy-MM-dd 00:00:00","picker-options":{disabledDate:function(t){return t.getTime()>Date.now()||0!==new Date(e.filterQuery.endTime).getTime()&&t.getTime()>new Date(e.filterQuery.endTime).getTime()}}},on:{change:function(t){return e.getFilterList("startTime")}},model:{value:e.filterQuery.startTime,callback:function(t){e.$set(e.filterQuery,"startTime",t)},expression:"filterQuery.startTime"}}),e._v("\n      ~\n      "),i("el-date-picker",{staticStyle:{width:"135px"},attrs:{type:"date",editable:"false",placeholder:"结束日期","value-format":"yyyy-MM-dd 23:59:59","picker-options":{disabledDate:function(t){return t.getTime()>Date.now()||0!==new Date(e.filterQuery.startTime).getTime()&&t.getTime()<new Date(e.filterQuery.startTime).getTime()}}},on:{change:function(t){return e.getFilterList("endTime")}},model:{value:e.filterQuery.endTime,callback:function(t){e.$set(e.filterQuery,"endTime",t)},expression:"filterQuery.endTime"}})],1),e._v(" "),i("el-form-item",[i("el-select",{on:{change:function(t){return e.getFilterList("sessionType")}},model:{value:e.filterQuery.sessionType,callback:function(t){e.$set(e.filterQuery,"sessionType",t)},expression:"filterQuery.sessionType"}},[i("el-option",{attrs:{label:"我的客户/他人代答",value:0}}),e._v(" "),i("el-option",{attrs:{label:"他人客户",value:1}})],1)],1),e._v(" "),i("el-form-item",[i("el-select",{on:{change:function(t){return e.getFilterList("exclusiveStatus")}},model:{value:e.filterQuery.exclusiveStatus,callback:function(t){e.$set(e.filterQuery,"exclusiveStatus",t)},expression:"filterQuery.exclusiveStatus"}},[i("el-option",{attrs:{label:"全部",value:-1}}),e._v(" "),i("el-option",{attrs:{label:"未处理留言",value:0}}),e._v(" "),i("el-option",{attrs:{label:"已处理留言",value:1}})],1)],1)],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"elTable",staticStyle:{width:"100%"},attrs:{size:"medium",data:e.list,stripe:"","max-height":e.tableHeight<400?400:e.tableHeight},on:{"sort-change":e.sortList,"row-dblclick":e.conversationShow}},[i("el-table-column",{attrs:{prop:"userId",label:"用户ID","min-width":"140"}}),e._v(" "),i("el-table-column",{attrs:{prop:"nickname",label:"用户昵称","min-width":"140"}}),e._v(" "),i("el-table-column",{attrs:{prop:"sessionType",label:"留言类型","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("sessionType2CH")(t.row.sessionType))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"留言内容","min-width":"140","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[2===t.row.messageType?i("span",[e._v("[图片]")]):i("span",[e._v(" "+e._s(t.row.lastMessage))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"留言时间","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("dateFormat")([t.row.lastLeaveTime,"MM-dd hh:mm"]))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"adminName",label:"专属客服","min-width":"140"}}),e._v(" "),i("el-table-column",{attrs:{prop:"exclusiveStatus",label:"专属客服是否处理","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(0===t.row.exclusiveStatus?"未处理":"已处理")+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"处理时间","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return 0!==t.row.exclusiveStatus?[e._v("\n        "+e._s(e._f("dateFormat")([t.row.updateTime,"MM-dd hh:mm"]))+"\n      ")]:void 0}}],null,!0)})],1),e._v(" "),i("el-pagination",{staticClass:"page-bar-reset",attrs:{background:"",layout:"prev, pager, next","current-page":Math.floor(e.offset/e.limit)+1,total:e.total,"page-size":e.limit},on:{"current-change":e.getFilterList,"update:currentPage":function(t){e.$set(Math,"floor(offset/limit) + 1",t)},"update:current-page":function(t){e.$set(Math,"floor(offset/limit) + 1",t)}}}),e._v(" "),i("Conversation",{attrs:{userInfo:e.currentSessionObj},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}})],1)},staticRenderFns:[]},et=i("VU/8")(Je,Ze,!1,null,null,null).exports,tt="/api/admin/css/session/querySessionHistory",it={name:"History",data:function(){return{offset:0,limit:20,total:1,drawer:!1,loading:!1,tableHeight:null,filterQuery:{startTime:"",endTime:"",sessionRange:0,search:""},currentSessionObj:{}}},computed:g()({},Object(R.d)(["windowHeight"])),created:function(){this.getFilterList(),this.setHeight()},components:{Conversation:Ye},filters:{status2CH:function(e){return{0:"失效",1:"过期",2:"有效"}[e]||"-"},level2CH:function(e){return{0:"小白",1:"银卡",2:"金卡",3:"钻石卡",4:"至尊VIP"}[e]||""}},methods:{setHeight:function(){var e=this;this.$nextTick(function(){e.tableHeight=e.windowHeight-e.$refs.elTable.$el.offsetTop-63})},getFilterList:function(e){var t=this;if(!this.loading){this.loading=!0,this.offset="number"==typeof e&&e?(e-1)*this.limit:0;var i={start:this.offset,limit:this.limit};this.filterQuery.startTime&&(i.startTime=this.filterQuery.startTime),this.filterQuery.endTime&&(i.endTime=this.filterQuery.endTime),this.filterQuery.sessionRange&&(i.sessionRange=this.filterQuery.sessionRange),this.filterQuery.search&&(i.search=this.filterQuery.search),this.$service(tt,{params:i}).then(function(e){t.loading=!1,200===e.code?(t.$refs.elTable.bodyWrapper.scrollTop=0,t.list=e.data.data||[],t.total=e.data.total||1):t.$message.error(e.code+":"+e.message)},function(e){e&&(t.loading=!1,t.$message.error(_()(e)))})}},conversationShow:function(e){this.drawer=!0,this.currentSessionObj=e}},watch:{windowHeight:function(){this.setHeight()}}},st={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"history"},[i("div",{staticClass:"nav-tools"},[i("div",{staticClass:"nav"},[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),e._v(" "),e._l(e.$route.matched,function(t,s){return i("el-breadcrumb-item",{key:s},[e._v(e._s(t.meta.title)+"\n        ")])})],2)],1),e._v(" "),i("div",{staticClass:"tools"},[i("el-input",{staticStyle:{width:"auto"},attrs:{placeholder:"用户ID/邮箱账号","prefix-icon":"el-icon-search",clearable:"",size:"mini"},on:{clear:function(t){return e.getFilterList()},change:function(t){return e.getFilterList("search")}},model:{value:e.filterQuery.search,callback:function(t){e.$set(e.filterQuery,"search",t)},expression:"filterQuery.search"}})],1)]),e._v(" "),i("el-form",{attrs:{model:e.filterQuery,inline:!0,size:"mini",disabled:e.loading}},[i("el-form-item",[i("el-date-picker",{staticStyle:{width:"135px"},attrs:{type:"date",editable:"false",placeholder:"开始日期","value-format":"yyyy-MM-dd 00:00:00","picker-options":{disabledDate:function(t){return t.getTime()>Date.now()||0!==new Date(e.filterQuery.endTime).getTime()&&t.getTime()>new Date(e.filterQuery.endTime).getTime()}}},on:{change:function(t){return e.getFilterList("startTime")}},model:{value:e.filterQuery.startTime,callback:function(t){e.$set(e.filterQuery,"startTime",t)},expression:"filterQuery.startTime"}}),e._v("\n      ~\n      "),i("el-date-picker",{staticStyle:{width:"135px"},attrs:{type:"date",editable:"false",placeholder:"结束日期","value-format":"yyyy-MM-dd 23:59:59","picker-options":{disabledDate:function(t){return t.getTime()>Date.now()||0!==new Date(e.filterQuery.startTime).getTime()&&t.getTime()<new Date(e.filterQuery.startTime).getTime()}}},on:{change:function(t){return e.getFilterList("endTime")}},model:{value:e.filterQuery.endTime,callback:function(t){e.$set(e.filterQuery,"endTime",t)},expression:"filterQuery.endTime"}})],1),e._v(" "),i("el-form-item",[i("el-select",{on:{change:function(t){return e.getFilterList("sessionRange")}},model:{value:e.filterQuery.sessionRange,callback:function(t){e.$set(e.filterQuery,"sessionRange",t)},expression:"filterQuery.sessionRange"}},[i("el-option",{attrs:{label:"全部",value:0}}),e._v(" "),i("el-option",{attrs:{label:"我的客户",value:1}})],1)],1)],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"elTable",staticStyle:{width:"100%"},attrs:{size:"medium",data:e.list,stripe:"","max-height":e.tableHeight<400?400:e.tableHeight},on:{"sort-change":e.sortList,"row-dblclick":e.conversationShow}},[i("el-table-column",{attrs:{prop:"userId",label:"用户ID","min-width":"140"}}),e._v(" "),i("el-table-column",{attrs:{label:"用户昵称","min-width":"150",prop:"userNickname"}}),e._v(" "),i("el-table-column",{attrs:{prop:"createTime",label:"最近会话开始时间","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("dateFormat")([t.row.createTime,"MM-dd hh:mm"]))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"activateAdminName",label:"接待客服","min-width":"130"}}),e._v(" "),i("el-table-column",{attrs:{prop:"exclusiveAdminName",label:"专属客服","min-width":"140"}}),e._v(" "),i("el-table-column",{attrs:{prop:"userLevel",label:"客户等级","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("level2CH")(t.row.userLevel))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"userStatus",label:"客户状态","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("status2CH")(t.row.userStatus))+"\n      ")]}}])})],1),e._v(" "),i("el-pagination",{staticClass:"page-bar-reset",attrs:{background:"",layout:"prev, pager, next","current-page":Math.floor(e.offset/e.limit)+1,total:e.total,"page-size":e.limit},on:{"current-change":e.getFilterList,"update:currentPage":function(t){e.$set(Math,"floor(offset/limit) + 1",t)},"update:current-page":function(t){e.$set(Math,"floor(offset/limit) + 1",t)}}}),e._v(" "),i("Conversation",{attrs:{userInfo:e.currentSessionObj},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}})],1)},staticRenderFns:[]},nt=i("VU/8")(it,st,!1,null,null,null).exports,at="/api/admin/css/user/customer/list",rt={name:"MyCustomer",data:function(){return{offset:0,limit:20,total:1,loading:!1,tableHeight:null,list:[],drawer:!1,filterQuery:{startTime:"",endTime:"",userStatus:-1,sessionCreateType:-1,search:""},currentSessionObj:{}}},computed:g()({},Object(R.d)(["windowHeight"])),created:function(){this.getFilterList(),this.setHeight()},filters:{status2CH:function(e){return{0:"失效",1:"过期",2:"有效"}[e]||"-"},level2CH:function(e){return{0:"小白",1:"银卡",2:"金卡",3:"钻石卡",4:"至尊VIP"}[e]||""},sessionType2CH:function(e){return{1:"是",2:"是",3:"否"}[e]||""},createType2CH:function(e){return{0:"客户",1:"客服"}[e]||""}},components:{Conversation:Ye},methods:{setHeight:function(){var e=this;this.$nextTick(function(){e.tableHeight=e.windowHeight-e.$refs.elTable.$el.offsetTop-63})},getFilterList:function(e){var t=this;if(!this.loading){this.loading=!0,this.offset="number"==typeof e&&e?(e-1)*this.limit:0;var i={offset:this.offset,limit:this.limit,userStatus:this.filterQuery.userStatus,sessionCreateType:this.filterQuery.sessionCreateType};this.filterQuery.startTime&&(i.startTime=this.filterQuery.startTime),this.filterQuery.endTime&&(i.endTime=this.filterQuery.endTime),this.filterQuery.search&&(i.search=this.filterQuery.search),this.$service(at,{params:i}).then(function(e){t.loading=!1,200===e.code?(t.$refs.elTable.bodyWrapper.scrollTop=0,t.list=e.data.data||[],t.total=e.data.total||1):t.$message.error(e.code+":"+e.message)},function(e){e&&(t.loading=!1,t.$message.error(_()(e)))})}},conversationShow:function(e){this.drawer=!0,this.currentSessionObj=e}},watch:{windowHeight:function(){this.setHeight()}}},ot={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"customer"},[i("div",{staticClass:"nav-tools"},[i("div",{staticClass:"nav"},[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),e._v(" "),e._l(e.$route.matched,function(t,s){return i("el-breadcrumb-item",{key:s},[e._v(e._s(t.meta.title)+"\n        ")])})],2)],1),e._v(" "),i("div",{staticClass:"tools"},[i("el-input",{staticStyle:{width:"auto"},attrs:{placeholder:"用户ID","prefix-icon":"el-icon-search",clearable:"",size:"mini"},on:{clear:function(t){return e.getFilterList()},change:function(t){return e.getFilterList("search")}},model:{value:e.filterQuery.search,callback:function(t){e.$set(e.filterQuery,"search",t)},expression:"filterQuery.search"}})],1)]),e._v(" "),i("el-form",{attrs:{model:e.filterQuery,inline:!0,size:"mini",disabled:e.loading}},[i("el-form-item",[i("el-date-picker",{staticStyle:{width:"135px"},attrs:{type:"date",editable:"false",placeholder:"开始日期","value-format":"yyyy-MM-dd 00:00:00","picker-options":{disabledDate:function(t){return t.getTime()>Date.now()||0!==new Date(e.filterQuery.endTime).getTime()&&t.getTime()>new Date(e.filterQuery.endTime).getTime()}}},on:{change:function(t){return e.getFilterList("startTime")}},model:{value:e.filterQuery.startTime,callback:function(t){e.$set(e.filterQuery,"startTime",t)},expression:"filterQuery.startTime"}}),e._v("\n      ~\n      "),i("el-date-picker",{staticStyle:{width:"135px"},attrs:{type:"date",editable:"false",placeholder:"结束日期","value-format":"yyyy-MM-dd 23:59:59","picker-options":{disabledDate:function(t){return t.getTime()>Date.now()||0!==new Date(e.filterQuery.startTime).getTime()&&t.getTime()<new Date(e.filterQuery.startTime).getTime()}}},on:{change:function(t){return e.getFilterList("endTime")}},model:{value:e.filterQuery.endTime,callback:function(t){e.$set(e.filterQuery,"endTime",t)},expression:"filterQuery.endTime"}})],1),e._v(" "),i("el-form-item",[i("el-select",{on:{change:function(t){return e.getFilterList("userStatus")}},model:{value:e.filterQuery.userStatus,callback:function(t){e.$set(e.filterQuery,"userStatus",t)},expression:"filterQuery.userStatus"}},[i("el-option",{attrs:{label:"全部",value:-1}}),e._v(" "),i("el-option",{attrs:{label:"失效客户",value:0}}),e._v(" "),i("el-option",{attrs:{label:"过期客户",value:1}}),e._v(" "),i("el-option",{attrs:{label:"有效客户",value:2}})],1)],1),e._v(" "),i("el-form-item",[i("el-select",{on:{change:function(t){return e.getFilterList("sessionCreateType")}},model:{value:e.filterQuery.sessionCreateType,callback:function(t){e.$set(e.filterQuery,"sessionCreateType",t)},expression:"filterQuery.sessionCreateType"}},[i("el-option",{attrs:{label:"全部",value:-1}}),e._v(" "),i("el-option",{attrs:{label:"客户发起",value:0}}),e._v(" "),i("el-option",{attrs:{label:"客服发起",value:1}})],1)],1)],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"elTable",attrs:{size:"medium",data:e.list,stripe:"","max-height":e.tableHeight<400?400:e.tableHeight},on:{"row-dblclick":e.conversationShow}},[i("el-table-column",{attrs:{prop:"userId",label:"用户ID","min-width":"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"nickname",label:"用户昵称","min-width":"160"}}),e._v(" "),i("el-table-column",{attrs:{prop:"apportionTime",label:"客户分配时间","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("dateFormat")([t.row.apportionTime,"MM-dd hh:mm"]))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"客户状态","min-width":"120",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("status2CH")(t.row.status))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"sessionType",label:"是否会话","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("sessionType2CH")(t.row.sessionType))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"最后发起人","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("createType2CH")(t.row.createType))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"最后通话记录时间","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("dateFormat")([t.row.lastMessageTime,"MM-dd  hh:mm"]))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"level",label:"客户等级","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("level2CH")(t.row.level))+"\n      ")]}}])})],1),e._v(" "),i("el-pagination",{staticClass:"page-bar-reset",attrs:{background:"",layout:"prev, pager, next","current-page":Math.floor(e.offset/e.limit)+1,total:e.total,"page-size":e.limit},on:{"current-change":e.getFilterList,"update:currentPage":function(t){e.$set(Math,"floor(offset/limit) + 1",t)},"update:current-page":function(t){e.$set(Math,"floor(offset/limit) + 1",t)}}}),e._v(" "),i("Conversation",{attrs:{userInfo:e.currentSessionObj},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}})],1)},staticRenderFns:[]},lt=i("VU/8")(rt,ot,!1,null,null,null).exports,ct=[{value:0,label:"运营"},{value:1,label:"值班客服"},{value:2,label:"客服管理员"}],ut={name:"SettingsPersonal",data:function(){return{offset:0,limit:20,total:1,loading:!1,tableHeight:null,customerShow:!1,adminNicknameTemp:"",updateLoading:!1,options:ct,form:{loginName:"",adminName:"",adminNickname:"",adminType:1}}},computed:g()({},Object(R.d)(["userInfo"]),{isAdmin:function(){return 2===this.userInfo.adminType}}),created:function(){this.userInfo.adminNickname&&(this.adminNicknameTemp=this.userInfo.adminNickname)},methods:{upNickname:function(){var e=this;this.adminNicknameTemp?M(xe,{method:"post",data:{nickname:this.adminNicknameTemp}}).then(function(t){200===t.code?(e.$message.success("更新成功！"),e.$store.dispatch("getUserInfo")):e.$message.error(t.code+":"+t.message)},function(t){e.$message.error(_()(t))}):(this.$message.error("昵称不能为空！"),this.adminNicknameTemp=this.userInfo.adminNickname)},upInfo:function(e){var t=this,i=null,s=null;"shortCut"===e&&(i={shortcutKey:this.userInfo.shortcutKey},s=Le),"avatar"===e&&(i={avatar:this.userInfo.avatar},s=Se),M(s,{method:"post",data:i}).then(function(e){200===e.code?(t.$message.success("更新成功！"),t.$store.dispatch("getUserInfo")):t.$message.error(e.code+":"+e.message)},function(e){t.$message.error(_()(e))})},uploadAvatarImg:function(e){var t,i,s,n=this;(t=e.file,i="thread",s=new FormData,s.append("0",t),M(L,{urlParams:{serviceType:i},method:"post",headers:{"Content-Type":"multipart/form-data"},data:s}).then(function(e){return 200===e.code?p.a.resolve(e.data[0].sourceUrl):p.a.reject(e.message)},function(e){return p.a.reject(_()(e))})).then(function(e){n.$store.state.userInfo.avatar=e,n.upInfo("avatar")},function(e){e&&n.$message.error("上传头像失败，请稍后再传！")})},beforeImgUpload:function(e){if(e.size/1024/1024>5)return this.$message.error("上传头像图片大小不能超过 5MB!"),!1},addPop:function(e){var t=this;this.form=w()({loginName:"",adminName:"",adminNickname:"",adminType:1},e||{}),this.$nextTick(function(){t.$refs.addForm.clearValidate()}),this.customerShow=!0},submitForm:function(e){var t=this;this.$refs.addForm.validate(function(e){if(e){var i=g()({},t.form);if(i.loginName=i.loginName+"@corp.netease.com",t.updateLoading)return;t.updateLoading=!0,t.$service(De,{method:"post",data:i}).then(function(e){t.updateLoading=!1,200===e.code?(t.customerShow=!1,t.$message.success("添加成功")):t.$message.error(e.code+":"+e.message)},function(e){t.updateLoading=!1,t.$message.error(_()(e))})}})}}},dt={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"settings-personal"},[i("div",{staticClass:"nav-tools"},[i("div",{staticClass:"nav"},[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),e._v(" "),e._l(e.$route.matched,function(t,s){return i("el-breadcrumb-item",{key:s},[e._v(e._s(t.meta.title))])})],2)],1),e._v(" "),e.isAdmin?i("div",{staticClass:"tools"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addPop()}}},[e._v("新增客服")])],1):e._e()]),e._v(" "),i("el-form",{attrs:{size:"medium","label-width":"100px"}},[i("el-form-item",{attrs:{label:"昵称"}},[i("el-input",{staticStyle:{width:"110px"},attrs:{disabled:e.isAdmin},on:{change:e.upNickname},model:{value:e.adminNicknameTemp,callback:function(t){e.adminNicknameTemp=t},expression:"adminNicknameTemp"}}),e._v(" "),e.isAdmin?i("span",[e._v("*昵称仅超管可修改")]):e._e()],1),e._v(" "),i("el-form-item",{attrs:{label:"头像"}},[i("el-upload",{staticClass:"single-uploader",attrs:{accept:".jpeg,.jpg,.png,.gif","show-file-list":!1,"http-request":e.uploadAvatarImg,"before-upload":e.beforeImgUpload}},[e.userInfo.avatar?i("img",{staticClass:"single-img",attrs:{src:e.userInfo.avatar+"?imageView&thumbnail=98y98&quality=85"}}):i("i",{staticClass:"el-icon-plus single-uploader-icon"})])],1),e._v(" "),i("el-form-item",{attrs:{label:"会话设置"}},[i("p",[i("el-radio",{attrs:{label:0},on:{change:function(t){return e.upInfo("shortCut")}},model:{value:e.userInfo.shortcutKey,callback:function(t){e.$set(e.userInfo,"shortcutKey",t)},expression:"userInfo.shortcutKey"}},[e._v("enter发送, Ctrl+enter换行\n        ")])],1),e._v(" "),i("p",[i("el-radio",{attrs:{label:1},on:{change:function(t){return e.upInfo("shortCut")}},model:{value:e.userInfo.shortcutKey,callback:function(t){e.$set(e.userInfo,"shortcutKey",t)},expression:"userInfo.shortcutKey"}},[e._v("Ctrl+enter发送, enter换行\n        ")])],1)])],1),e._v(" "),i("el-dialog",{directives:[{name:"show",rawName:"v-show",value:e.customerShow,expression:"customerShow"}],attrs:{title:"新增客服",visible:e.customerShow,width:"600px","close-on-click-modal":!1,center:""},on:{"update:visible":function(t){e.customerShow=t}}},[i("el-form",{ref:"addForm",attrs:{model:e.form,disabled:e.updateLoading,"label-width":"150px",size:"small"}},[i("el-form-item",{attrs:{label:"corp邮箱",prop:"loginName",rules:[{required:!0,message:"客服昵称不为空",trigger:["blur","change"]}]}},[i("el-input",{attrs:{placeholder:"输入corp邮箱"},model:{value:e.form.loginName,callback:function(t){e.$set(e.form,"loginName",t)},expression:"form.loginName"}},[i("template",{slot:"append"},[e._v("@corp.netease.com")])],2)],1),e._v(" "),i("el-form-item",{attrs:{label:"真实姓名",prop:"adminName",rules:[{required:!0,message:"真实姓名不为空",trigger:["blur","change"]}]}},[i("el-input",{model:{value:e.form.adminName,callback:function(t){e.$set(e.form,"adminName",t)},expression:"form.adminName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"客服昵称",prop:"adminNickname",rules:[{required:!0,message:"客服昵称不为空",trigger:["blur","change"]}]}},[i("el-input",{model:{value:e.form.adminNickname,callback:function(t){e.$set(e.form,"adminNickname",t)},expression:"form.adminNickname"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"客服身份",prop:"adminType",rules:[{required:!0,message:"客服身份必选",trigger:["blur","change"]}]}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.adminType,callback:function(t){e.$set(e.form,"adminType",t)},expression:"form.adminType"}},e._l(e.options,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.customerShow=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",loading:e.updateLoading},on:{click:function(t){return e.submitForm("addForm")}}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var mt=i("VU/8")(ut,dt,!1,function(e){i("hML9")},null,null).exports;var ft={name:"Editor",props:["value"],data:function(){return{content:"",isEmoji:!1,viewStyle:{italic:!1,underline:!1,bold:!1}}},components:{Emoji:Qe},created:function(){document.addEventListener("click",this.hideEmoji)},mounted:function(){this.value?this.setContent(this.value):this.clear()},beforeDestroy:function(){document.removeEventListener("click",this.hideEmoji)},watch:{value:function(e){e?this.setContent(e):this.clear()}},methods:{execCommand:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"insertHTML",t=arguments[1];Ce(),this.$refs.textarea.focus(),document.execCommand(e,!1,t),Ie()},textareaPaste:function(e){e.preventDefault();var t=e.clipboardData.getData("text");this.execCommand("insertText",Et(t))},textareaSaveSelection:function(){Ie()},setTagStyle:function(){this.viewStyle=function(){var e=Fe||$e(),t=e&&e.commonAncestorContainer,i=["U","I","B"],s=[];if(t){var n=null;for(3===t.nodeType&&(t=t.parentNode),n=t;n&&n.nodeName&&-1===s.indexOf(n.nodeName.toLowerCase());)-1!==i.indexOf(n.nodeName)&&s.push(n.nodeName),n=n.parentNode}return{italic:-1!==s.indexOf("I"),underline:-1!==s.indexOf("U"),bold:-1!==s.indexOf("B")}}()},textareaInput:function(e){this.content=e.target.innerHTML,this.$emit("input",this.content)},switchEmoji:function(){this.isEmoji=!this.isEmoji,this.$refs.textarea.focus(),Ce()},insertEmoji:function(e){this.$refs.textarea.focus(),Ce(),this.execCommand("insertHTML",e),Ie()},hideEmoji:function(e){this.$refs.emoji.$el.contains(e.target)||(this.isEmoji=!1)},addLink:function(){var e=this;this.$prompt("请输入网址",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^((http|https|ftp):\/\/)(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,=]|:|@)|\/|\?)*)?$/i,inputErrorMessage:"网址格式不正确"}).then(function(t){var i=t.value;e.execCommand("createlink",i)})},clear:function(){this.$refs.textarea.innerHTML="<p><br /></p>",this.content=""},setContent:function(e){e=/<p>/gi.test(e)?e:"<p>"+e+"</p>",this.$refs.textarea.innerHTML=e,this.content=e}}},ht={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"editor-wrapper"},[i("div",{staticClass:"editor-wrapper__toolbar"},[i("li",[i("span",{staticClass:"icon-emoji",class:{active:e.isEmoji},on:{click:function(t){return t.stopPropagation(),e.switchEmoji(t)}}}),e._v(" "),i("emoji",{ref:"emoji",on:{click:e.insertEmoji},model:{value:e.isEmoji,callback:function(t){e.isEmoji=t},expression:"isEmoji"}})],1),e._v(" "),i("li",{staticClass:"inline-command"},[i("span",{class:{active:e.viewStyle.bold},on:{click:function(t){return e.execCommand("bold")}}},[i("b",[e._v("B")])]),e._v(" "),i("span",{class:{active:e.viewStyle.italic},on:{click:function(t){return e.execCommand("italic")}}},[e._m(0)]),e._v(" "),i("span",{class:{active:e.viewStyle.underline},on:{click:function(t){return e.execCommand("underline")}}},[e._m(1)]),e._v(" "),i("span",{on:{click:e.addLink}},[e._m(2)])])]),e._v(" "),i("div",{ref:"textarea",staticClass:"editor-wrapper__content",attrs:{contenteditable:"true",spellcheck:"false",tabindex:"0"},on:{keyup:function(t){e.textareaSaveSelection(),e.setTagStyle()},mouseup:function(t){e.textareaSaveSelection(),e.setTagStyle()},mouseout:e.textareaSaveSelection,paste:e.textareaPaste,input:e.textareaInput}},[e._m(3)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("b",[t("i",[this._v("I")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("b",[t("u",[this._v("U")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("b",[t("u",[this._v("A")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("br")])}]};var pt={name:"SettingsQuickReply",data:function(){return{listType:"filter",offset:0,limit:20,total:1,loading:!1,tableHeight:null,form:{},list:[],activeTab:"0",searchQuery:"",updateLoading:!1,replyVisible:!1}},components:{Editor:i("VU/8")(ft,ht,!1,function(e){i("EuG/")},null,null).exports},computed:g()({},Object(R.d)(["windowHeight"])),created:function(){this.getList(),this.setHeight()},methods:{setHeight:function(){var e=this;this.$nextTick(function(){e.tableHeight=e.windowHeight-e.$refs.elTable.$el.offsetTop-63})},handleClickTabs:function(){this.searchQuery="",this.getList()},getList:function(e){var t=this;this.loading||(this.loading=!0,this.listType="filter",this.offset="number"==typeof e&&e?(e-1)*this.limit:0,this.$service(Ee,{params:{typeId:this.activeTab,offset:this.offset,limit:this.limit}}).then(function(e){t.loading=!1,200===e.code?(t.$refs.elTable.bodyWrapper.scrollTop=0,t.list=e.data.data||[],t.total=e.data.total||1):t.$message.error(e.code+":"+e.message)},function(e){e&&(t.loading=!1,t.$message.error(_()(e)))}))},getSearchList:function(){var e=this;this.searchQuery&&!this.loading&&(this.loading=!0,this.listType="search",this.$service(Re,{method:"post",data:{key:this.searchQuery}}).then(function(t){e.loading=!1,200===t.code?(e.$refs.elTable.bodyWrapper.scrollTop=0,e.list=t.data.filter(function(t){return t.typeId.toString()===e.activeTab})):e.$message.error(t.code+":"+t.message)},function(t){t&&(e.loading=!1,e.$message.error(_()(t)))}))},replyPop:function(e){var t=this;this.form=w()({fastKey:"",content:""},e||{}),this.$refs.editor&&(this.$refs.editor.clear(),this.form.content&&this.$refs.editor.setContent(this.form.content)),this.$nextTick(function(){t.$refs.replyForm.clearValidate()}),this.replyVisible=!0},submitForm:function(e){var t=this;this.$refs.replyForm.validate(function(e){if(e){if(t.updateLoading)return;var i={typeId:t.activeTab,key:t.form.fastKey,content:Et(t.$refs.editor.content.replace("</p><p>","<br />").replace("<p>","").replace("</p>",""))};if(t.form.fastReplyId&&(i.fastReplyId=t.form.fastReplyId),!(i.content.length>0&&"<p><br /></p>"!==i.content&&"<p><br/></p>"!==i.content&&"<p><br></p>"!==i.content))return t.$message.error("快捷回复内容不能为空");t.updateLoading=!0,t.$service(i.fastReplyId?Me:Ne,{method:"post",data:i}).then(function(e){t.updateLoading=!1,200===e.code?(t.replyVisible=!1,t.getList(),t.$message.success((i.fastReplyId?"更新":"添加")+"成功")):t.$message.error(e.code+":"+e.message)},function(e){t.updateLoading=!1,t.$message.error(_()(e))})}})},del:function(e){var t=this;e.loading||(this.$set(e,"loading",!0),this.$service(He,{method:"post",data:{fastReplyId:e.fastReplyId}}).then(function(i){e.loading=!1,200===i.code?(e.delPop=!1,t.$message.success("删除成功"),t.getList(Math.floor(t.offset/t.limit)+1)):t.$message.error(i.code+":"+i.message)},function(i){e.loading=!1,t.$message.error(_()(i))}))}},watch:{windowHeight:function(){this.setHeight()}}},vt={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"quick-reply"},[i("div",{staticClass:"nav-tools"},[i("div",{staticClass:"nav"},[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),e._v(" "),e._l(e.$route.matched,function(t,s){return i("el-breadcrumb-item",{key:s},[e._v(e._s(t.meta.title))])})],2)],1),e._v(" "),i("div",{staticClass:"tools"},[i("el-input",{staticStyle:{width:"130px"},attrs:{clearable:"",placeholder:"搜索快捷回复"},on:{clear:function(t){return e.getList()},change:function(t){return e.getSearchList("search")}},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}}),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.replyPop()}}},[e._v("添加快捷回复")])],1)]),e._v(" "),i("el-tabs",{on:{"tab-click":e.handleClickTabs},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[i("el-tab-pane",{attrs:{label:"公共库",name:"0"}}),e._v(" "),i("el-tab-pane",{attrs:{label:"个人库",name:"1"}})],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"elTable",staticStyle:{width:"100%"},attrs:{size:"medium",data:e.list,stripe:"","max-height":e.tableHeight<400?400:e.tableHeight}},[i("el-table-column",{attrs:{label:"快捷词",width:"140",prop:"fastKey"}}),e._v(" "),i("el-table-column",{attrs:{prop:"content",label:"快捷回复内容"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:"",size:"small"},on:{click:function(i){return e.replyPop(t.row)}}}),e._v(" "),i("el-popover",{attrs:{placement:"left"},model:{value:t.row.delPop,callback:function(i){e.$set(t.row,"delPop",i)},expression:"scope.row.delPop"}},[i("p",[e._v("确定删除？")]),e._v(" "),i("div",{staticStyle:{"text-align":"right",margin:"0"}},[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.row.delPop=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini",loading:t.row.loading},on:{click:function(i){return e.del(t.row)}}},[e._v("确定")])],1),e._v(" "),i("el-button",{attrs:{slot:"reference",type:"success",icon:"el-icon-delete",circle:"",size:"small"},slot:"reference"})],1)]}}])})],1),e._v(" "),i("el-pagination",{directives:[{name:"show",rawName:"v-show",value:"filter"===e.listType,expression:"listType === 'filter'"}],staticClass:"page-bar-reset",attrs:{background:"",layout:"prev, pager, next","current-page":Math.floor(e.offset/e.limit)+1,total:e.total,"page-size":e.limit},on:{"current-change":e.getList,"update:currentPage":function(t){e.$set(Math,"floor(offset/limit) + 1",t)},"update:current-page":function(t){e.$set(Math,"floor(offset/limit) + 1",t)}}}),e._v(" "),i("el-dialog",{attrs:{title:e.form.fastReplyId?"修改快捷回复":"添加快捷回复",visible:e.replyVisible,width:"600px","close-on-click-modal":!1,center:""},on:{"update:visible":function(t){e.replyVisible=t}}},[i("el-form",{ref:"replyForm",attrs:{model:e.form,disabled:e.updateLoading,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"快捷词",prop:"fastKey",rules:{required:!0,message:"快捷词不为空",trigger:["blur","change"]}}},[i("el-input",{attrs:{placeholder:"输入快捷回复"},model:{value:e.form.fastKey,callback:function(t){e.$set(e.form,"fastKey",t)},expression:"form.fastKey"}},[i("template",{slot:"prepend"},[e._v("#")])],2)],1),e._v(" "),i("el-form-item",{attrs:{label:"快捷回复内容"}},[i("Editor",{ref:"editor",attrs:{value:e.form.content}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.replyVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",loading:e.updateLoading},on:{click:function(t){return e.submitForm("replyForm")}}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var gt=i("VU/8")(pt,vt,!1,function(e){i("7Emc")},null,null).exports,bt="/api/admin/css/session/adminSessionStats",_t="/api/admin/css/coupleBack/list",yt="/api/admin/css/coupleBack/update/updateRemark",wt={name:"statistics",data:function(){return{loading:!1,tableHeight:null,list:[],filterQuery:{startDate:"",endDate:""}}},computed:g()({},Object(R.d)(["windowHeight"])),created:function(){this.getFilterList(),this.setHeight()},methods:{setHeight:function(){var e=this;this.$nextTick(function(){e.tableHeight=e.windowHeight-e.$refs.elTable.$el.offsetTop-63})},getFilterList:function(e){var t=this;if(!this.loading){this.loading=!0;var i={};this.filterQuery.startDate&&(i.startDate=this.filterQuery.startDate),this.filterQuery.endDate&&(i.endDate=this.filterQuery.endDate),this.$service(bt,{params:i}).then(function(e){t.loading=!1,200===e.code?(0===o()(e.data).length?t.list=[]:t.list=e.data,t.$refs.elTable.bodyWrapper.scrollTop=0):t.$message.error(e.code+":"+e.message)},function(e){e&&(t.loading=!1,t.$message.error(_()(e)))})}}},watch:{windowHeight:function(){this.setHeight()}}},Tt={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"customer"},[i("div",{staticClass:"nav-tools"},[i("div",{staticClass:"nav"},[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),e._v(" "),e._l(e.$route.matched,function(t,s){return i("el-breadcrumb-item",{key:s},[e._v(e._s(t.meta.title)+"\n        ")])})],2)],1)]),e._v(" "),i("el-form",{attrs:{model:e.filterQuery,inline:!0,size:"mini",disabled:e.loading}},[i("el-form-item",[i("el-date-picker",{staticStyle:{width:"135px"},attrs:{type:"date",editable:"false",placeholder:"开始日期","value-format":"yyyy-MM-dd 00:00:00","picker-options":{disabledDate:function(t){return t.getTime()>Date.now()-864e5||0!==new Date(e.filterQuery.endDate).getTime()&&t.getTime()>new Date(e.filterQuery.endDate).getTime()}}},model:{value:e.filterQuery.startDate,callback:function(t){e.$set(e.filterQuery,"startDate",t)},expression:"filterQuery.startDate"}}),e._v("\n      ~\n      "),i("el-date-picker",{staticStyle:{width:"135px"},attrs:{type:"date",editable:"false",placeholder:"结束日期","value-format":"yyyy-MM-dd 23:59:59","picker-options":{disabledDate:function(t){return t.getTime()>Date.now()-864e5||0!==new Date(e.filterQuery.startDate).getTime()&&t.getTime()<new Date(e.filterQuery.startDate).getTime()}}},model:{value:e.filterQuery.endDate,callback:function(t){e.$set(e.filterQuery,"endDate",t)},expression:"filterQuery.endDate"}})],1),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getFilterList()}}},[e._v("筛选")])],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"elTable",attrs:{size:"medium",data:e.list,stripe:"","max-height":e.tableHeight<400?400:e.tableHeight},on:{"row-dblclick":e.conversationShow}},[i("el-table-column",{attrs:{prop:"adminName",label:"客服姓名","min-width":"120"}}),e._v(" "),i("el-table-column",{attrs:{prop:"onWorkTime",label:"在班时长(h)","min-width":"160"}}),e._v(" "),i("el-table-column",{attrs:{prop:"onWorkTimeAvg",label:"日均在班时长","min-width":"140"}}),e._v(" "),i("el-table-column",{attrs:{label:"处理客服总次数","min-width":"120",prop:"serviceCount"}}),e._v(" "),i("el-table-column",{attrs:{prop:"serviceCountAvg",label:"日均处理客服次数","min-width":"140"}}),e._v(" "),i("el-table-column",{attrs:{prop:"delayReplyCount",label:"3分钟未响应客诉总次数","min-width":"140"}}),e._v(" "),i("el-table-column",{attrs:{prop:"delayReplyCountAvg",label:"日均3分钟未响应客诉总次数","min-width":"160"}})],1)],1)},staticRenderFns:[]},kt=i("VU/8")(wt,Tt,!1,null,null,null).exports,Ft={name:"feedback",data:function(){return{offset:0,limit:20,total:1,loading:!1,tableHeight:null,list:[]}},computed:g()({},Object(R.d)(["windowHeight"])),created:function(){this.getFilterList(),this.setHeight()},methods:{setHeight:function(){var e=this;this.$nextTick(function(){e.tableHeight=e.windowHeight-e.$refs.elTable.$el.offsetTop-63})},getFilterList:function(e){var t=this;if(!this.loading){this.loading=!0,this.offset="number"==typeof e&&e?(e-1)*this.limit:0;var i={offset:this.offset,limit:this.limit};this.$service(_t,{params:i}).then(function(e){t.loading=!1,200===e.code?(t.$refs.elTable.bodyWrapper.scrollTop=0,e.data.data.forEach(function(e){e.remarkTemp=e.remark,e.isEdit=!1}),t.list=e.data.data||[],t.total=e.data.total||1):t.$message.error(e.code+":"+e.message)},function(e){e&&(t.loading=!1,t.$message.error(_()(e)))})}},isEditChange:function(e){var t=this;e.remark=e.remarkTemp,e.isEdit=!0,this.$nextTick(function(){t.$refs.textarea.$refs.textarea.focus()})},updataRemark:function(e){var t=this;e.remark.length>20?this.$message.error("最长不超过20个字符！"):this.$service(yt,{method:"post",data:{coupleBackId:e.coupleBackId,remark:e.remark}}).then(function(i){t.loading=!1,200===i.code?(t.$message.success("更新成功！"),e.remarkTemp=e.remark,e.isEdit=!1):t.$message.error(i.code+":"+i.message)},function(e){e&&(t.loading=!1,t.$message.error(_()(e)))})}},watch:{windowHeight:function(){this.setHeight()}}},$t={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"customer"},[i("div",{staticClass:"nav-tools"},[i("div",{staticClass:"nav"},[i("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),e._v(" "),e._l(e.$route.matched,function(t,s){return i("el-breadcrumb-item",{key:s},[e._v(e._s(t.meta.title)+"\n        ")])})],2)],1)]),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"elTable",attrs:{size:"medium",data:e.list,stripe:"","max-height":e.tableHeight<400?400:e.tableHeight},on:{"row-dblclick":e.conversationShow}},[i("el-table-column",{attrs:{prop:"userId",label:"客户ID","min-width":"80"}}),e._v(" "),i("el-table-column",{attrs:{prop:"createTime",label:"反馈时间","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("dateFormat")([t.row.createTime,"yyyy-MM-dd hh:mm"]))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"adminName",label:"专属客服","min-width":"80"}}),e._v(" "),i("el-table-column",{attrs:{label:"反馈内容","min-width":"180",prop:"content"}}),e._v(" "),i("el-table-column",{attrs:{prop:"remark",label:"备注","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?e._e():i("div",{staticClass:"remark-show",on:{click:function(i){return e.isEditChange(t.row)}}},[e._v("\n          "+e._s(t.row.remarkTemp)+"\n        ")]),e._v(" "),t.row.isEdit?i("el-input",{ref:"textarea",staticStyle:{width:"160px"},attrs:{type:"textarea",size:"small"},on:{blur:function(e){t.row.isEdit=!1},change:function(i){return e.updataRemark(t.row)}},model:{value:t.row.remark,callback:function(i){e.$set(t.row,"remark",i)},expression:"scope.row.remark"}}):e._e()]}}])})],1),e._v(" "),i("el-pagination",{staticClass:"page-bar-reset",attrs:{background:"",layout:"prev, pager, next","current-page":Math.floor(e.offset/e.limit)+1,total:e.total,"page-size":e.limit},on:{"current-change":e.getFilterList,"update:currentPage":function(t){e.$set(Math,"floor(offset/limit) + 1",t)},"update:current-page":function(t){e.$set(Math,"floor(offset/limit) + 1",t)}}})],1)},staticRenderFns:[]};var It=i("VU/8")(Ft,$t,!1,function(e){i("8ALM")},null,null).exports;c.a.use(z.a);var Ct=[{path:"*",name:"Error",component:X,meta:{title:"404",navShow:!1}},{path:"/401",name:"Forbidden",component:G,meta:{title:"401",navShow:!1}},{path:"/",name:"home",redirect:"/current",meta:{title:"首页",navShow:!1}},{path:"/current",name:"Current",component:Be,meta:{title:"当前会话",navShow:!0}},{path:"/message",name:"Message",component:et,meta:{title:"留言记录",navShow:!0}},{path:"/history",name:"History",component:nt,meta:{title:"历史会话",navShow:!0}},{path:"/mycustomer",name:"MyCustomer",component:lt,meta:{title:"我的客户",navShow:!0}},{path:"/settings",name:"Settings",component:B,redirect:"/settings/personal",meta:{title:"客服设置",navShow:!0},children:[{path:"personal",name:"SettingsPersonal",component:mt,meta:{title:"个人设置",navShow:!0}},{path:"quickreply",name:"SettingsQuickReply",component:gt,meta:{title:"快捷回复",navShow:!0}}]},{path:"/statisticsfeedback",name:"StatisticsFeedback",component:B,redirect:"/staticsfeedback/statistics",meta:{title:"统计与反馈",navShow:!0},children:[{path:"statistics",name:"Statistics",component:kt,meta:{title:"会话统计",navShow:!0}},{path:"feedback",name:"Feedback",component:It,meta:{title:"用户反馈",navShow:!0}}]}],xt=new z.a({routes:Ct});xt.beforeEach(function(e,t,i){if(P.state.userInfo)i();else{var s=u.Loading.service();P.dispatch("getUserInfo").then(function(){i(),s.close()},function(){s.close(),window.location.href=window.location.origin+S})}});var St=xt,Lt=function(){return function e(t){if(!t||0===t.length)return[];var i=[];return t.map(function(t){t.meta&&t.meta.keepAlive&&i.push(t.name),t.children&&(i=[].concat(Q()(i),Q()(e(t.children))))}),i}(Ct)},Dt=function(e,t,i){if(!e)return i||"";var s=new Date(e),n={"M+":s.getMonth()+1,"d+":s.getDate(),"h+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?n[a]:("00"+n[a]).substr((""+n[a]).length)));return t},Et=function(e){return e.replace(/&nbsp;/g," ").replace(/<script.*?>.*?<\/script>/gim,"").replace(/<[^>]+/g,function(e){return e.replace(/ (on\w+=)/g," _$1")})},Nt=function(e,t){var i=void 0,s=void 0;return function(n){var a=this,r=arguments,o=+new Date;i&&o<i+t?(clearTimeout(s),s=setTimeout(function(){i=o,e.apply(a,r)},t)):(i=o,e.apply(a,r))}};var Mt=i("o/zv"),Rt=i.n(Mt),Ht={name:"MenuNavItem",props:["routerData","navIndex","basePath"],components:{refreshIcon:{data:function(){return{animateShow:!1}},methods:{animateClick:function(){var e=this;this.animateShow=!0,this.$store.dispatch("getSessionList"),setTimeout(function(){e.animateShow=!1},1500)}},render:function(){var e=arguments[0],t={color:"rgb(98,176,116)",fontWeight:"bold",marginLeft:"20px"};return this.animateShow&&(t.animation="circleRotate 1s infinite linear"),e("i",{class:"el-icon-refresh "+(this.animateShow?"animate":""),on:{click:this.animateClick},style:t})}}},methods:{resolvePath:function(e){return Rt.a.resolve(this.basePath,e)}}},jt={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"menu-wrap"},[e.routerData.children?i("el-submenu",{attrs:{index:e.navIndex}},[i("template",{slot:"title"},[e._v("\n      "+e._s(e.routerData.meta.title)+"\n      "),"Current"===e.routerData.name?i("refresh-icon"):e._e()],1),e._v(" "),e._l(e.routerData.children,function(t,s){return i("MenuNavItem",{directives:[{name:"show",rawName:"v-show",value:t.meta.navShow&&e.routerData.children,expression:"item.meta.navShow&&routerData.children"}],key:s,attrs:{routerData:t,navIndex:e.navIndex+"-"+(s+1),basePath:e.resolvePath(e.routerData.path)}})})],2):i("router-link",{attrs:{to:e.resolvePath(e.routerData.path)}},[i("el-menu-item",{attrs:{index:e.resolvePath(e.routerData.path)}},[i("span",{attrs:{slot:"title"},slot:"title"},[e._v("\n        "+e._s(e.routerData.meta.title)+"\n        "),"Current"===e.routerData.name?i("refresh-icon"):e._e()],1)])],1)],1)},staticRenderFns:[]},Ot={name:"menuNav",data:function(){return{routerMap:Ct}},components:{MenuNavItem:i("VU/8")(Ht,jt,!1,null,null,null).exports},methods:{checkAuth:function(e,t){return s=t,!(!(i=e)||!s||!i.filter(function(e){return s.includes(e)}).length);var i,s}}},Ut={render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-menu",{attrs:{"default-active":this.$route.path}},this._l(this.routerMap,function(e,i){return t("MenuNavItem",{directives:[{name:"show",rawName:"v-show",value:e.meta.navShow,expression:"item.meta.navShow"}],key:i,attrs:{routerData:e,navIndex:i+1,basePath:e.path}})}),1)},staticRenderFns:[]};var Qt=i("VU/8")(Ot,Ut,!1,function(e){i("ls2X")},null,null).exports,zt={name:"AsideFixed",components:{MenuNav:Qt}},At={render:function(){var e=this.$createElement,t=this._self._c||e;return this.$store.state.userInfo?t("el-aside",{staticClass:"aside-fixed",attrs:{width:"180px"}},[t("el-scrollbar",{staticStyle:{position:"absolute",top:"0",bottom:"0",width:"100%"},attrs:{"wrap-class":"scrollbar-wrapper"}},[t("MenuNav")],1)],1):this._e()},staticRenderFns:[]};var Vt=i("VU/8")(zt,At,!1,function(e){i("Qstd")},"data-v-ec24cb58",null).exports,Pt={name:"AsideDrawer",components:{MenuNav:Qt}},qt={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.$store.state.userInfo?i("div",{staticClass:"aside-drawer",class:{open:e.$store.state.menuOpen}},[i("div",{staticClass:"mask",on:{click:function(t){e.$store.state.menuOpen=!1}}}),e._v(" "),i("el-aside",{staticClass:"aside-fixed",attrs:{width:"180px"}},[i("el-scrollbar",{staticStyle:{position:"absolute",top:"0",bottom:"0",width:"100%"},attrs:{"wrap-class":"scrollbar-wrapper"}},[i("MenuNav")],1)],1)],1):e._e()},staticRenderFns:[]};var Wt=i("VU/8")(Pt,qt,!1,function(e){i("8tCS")},"data-v-77edbeb5",null).exports,Bt={name:"Dialog",data:function(){return{centerDialogVisible:!1,question:!1,beforeUnload_time:0,gap_time:0}},mounted:function(){1!==window.performance.navigation.type&&(this.centerDialogVisible=!0,this.question=!0)},methods:{submitStatus:function(e){var t=this;this.centerDialogVisible=!1,this.$store.state.userInfo.loginStatus=e,M(D,{method:"post",params:{loginStatus:e}}).then(function(i){200===i.code?(t.status=e,t.$message.success("更新成功！")):t.$message.error(i.code+":"+i.message)},function(e){t.$message.error(_()(e))})}}},Kt={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"在班状态",visible:e.centerDialogVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"30%"},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[i("span",[e._v(" "+e._s(e.question?"今日是否在班？":"是否下班？"))]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){return e.submitStatus(1)}}},[e._v("在班")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitStatus(0)}}},[e._v("下班")])],1)])},staticRenderFns:[]},Xt=i("VU/8")(Bt,Kt,!1,null,null,null).exports,Yt=0,Gt=null,Jt={name:"App",data:function(){return{sessionListTimer:null,aliveTimer:null,wsAddress:null}},computed:g()({},Object(R.d)(["userInfo","ws","wsStatus"]),{keepAliveRoutes:function(){return Lt()}}),created:function(){var e=this;window.onload=function(){"Notification"in window&&Notification.requestPermission(),window.onbeforeunload=function(e){return(e=e||window.event)&&(e.returnValue="关闭提示"),"关闭提示"}},window.onresize=function(){e.$store.state.windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e.$store.state.windowWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}},components:{Header:O,AsideFixed:Vt,AsideDrawer:Wt,Dialog:Xt},watch:{$route:function(){this.$store.state.menuOpen&&(this.$store.state.menuOpen=!1,window.scrollTo(0,0))},ws:function(e){var t=this;e&&(e.message=function(e){e.body&&t.$bus.$emit("wsPushData",e.body)})},userInfo:function(e){var t=this;e&&(window.WaterMark.mark({text:e.loginName}),this.getSessionListAndNotification(),this.sessionListTimer=setInterval(function(){t.getSessionListAndNotification()},2e3),this.keepLive(),this.connectWs(),this.aliveTimer=setInterval(this.keepLive,6e4))},wsStatus:function(e){"OPEN"===e?(Yt=0,this.ws.send({headers:{cmd:"bind",from:this.userInfo.adminId+"_1"}})):"CONNECTING"!==e&&"NOT_SUPPORT"!==e&&this.reconnectWs()}},methods:g()({},Object(R.c)(["setWs","setWsStatus"]),{keepLive:function(){this.$service("/api/admin/css/admin/keep/live")},getSessionListAndNotification:function(){this.$store.dispatch("getSessionList").then(function(e){if(e.data.filter(function(e){return e.notReadNum>0}).length>0){var t={renotify:!0,tag:1e3},i=Notification.permission;if("granted"===i){var s=new Notification("有新客服消息啦~",t);s.onclick=function(){s.close()}}else"default"===i&&Notification.requestPermission().then(function(e){if("granted"===e){var i=new Notification("有新客服消息啦~",t);i.onclick=function(){i.close()}}})}}).catch(function(e){})},getWsAddress:function(){return this.$service("/api/admin/css/ws/client/access",{method:"post",data:{appId:1}}).then(function(e){return 200===e.code&&e.data.accessOpen?p.a.resolve(e.data):p.a.reject(e)},function(e){if(e)return p.a.reject(new Error("网络错误"))})},connectWs:function(){var e=this;this.getWsAddress().then(function(t){var i=e,s=new x({url:t.serverAddr+"?AccessToken="+t.sign,statusCallback:function(e){i.setWsStatus(e)}});e.setWs(s)}).catch(function(t){"object"===(void 0===t?"undefined":f()(t))&&t.data&&!1===t.data.accessOpen||e.reconnectWs()})},reconnectWs:function(){var e=this;clearTimeout(Gt),Yt>=8||(Yt++,Gt=setTimeout(function(){e.connectWs()},2e3*Math.pow(2,Yt)))}})},Zt={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("el-container",{staticStyle:{"min-height":"100vh"}},[t("el-header",{staticStyle:{"background-color":"#62B074",position:"fixed",left:"0",top:"0",right:"0","z-index":"999"},attrs:{height:"48px"}},[t("Header")],1),this._v(" "),this.$store.state.windowWidth>=1280?t("AsideFixed"):t("AsideDrawer"),this._v(" "),t("el-main",{style:{margin:"48px 0 0 "+(this.$store.state.windowWidth>=1280?180:0)+"px","min-width":"768px"}},[t("keep-alive",{attrs:{include:[].concat(this.keepAliveRoutes)}},[t("router-view")],1)],1),this._v(" "),t("Dialog")],1)],1)},staticRenderFns:[]};var ei=i("VU/8")(Jt,Zt,!1,function(e){i("ZE5v")},null,null).exports,ti=i("d7EF"),ii=i.n(ti),si=function(e){var t=ii()(e,3),i=t[0],s=t[1],n=t[2];return Dt(i,s,n)};i("lVTU");c.a.config.productionTip=!1,o()(s).forEach(function(e){c.a.filter(e,s[e])}),c.a.use(d.a,{size:"mini"}),c.a.prototype.$service=M;var ni=new c.a;a()(c.a.prototype,{$bus:{get:function(){return ni}}}),new c.a({el:"#app",router:St,store:P,components:{App:ei},template:"<App/>"})},"7Emc":function(e,t){},"8ALM":function(e,t){},"8tCS":function(e,t){},Eh2o:function(e,t){},"EuG/":function(e,t){},ID8m:function(e,t){},Qstd:function(e,t){},R6KW:function(e,t){},VK8O:function(e,t){},ZE5v:function(e,t){},cF9M:function(e,t){},hML9:function(e,t){},lRwf:function(e,t){e.exports=Vue},lVTU:function(e,t){},ls2X:function(e,t){},tRRL:function(e,t){}},[1]);